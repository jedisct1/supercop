// SPDX-License-Identifier: MIT

#ifndef AIM2_H
#define AIM2_H

#include "field.h"
#include "params.h"
#include <stdint.h>

static const GF aim2_constants[AIM2_NUM_INPUT_SBOX] =
{
  {0xc0ac29b7c97c50dd, 0xbe5466cf34e90c6c, 0x452821e638d01377},
  {0xd1310ba698dfb5ac, 0x9216d5d98979fb1b, 0x3f84d5b5b5470917}
};

static const GF aim2_e2_power_matrix[AIM2_NUM_BITS_FIELD] =
{
  {0x0000000000000001, 0x0000000000000000, 0x0000000000000000},
  {0x75575b2a01927c2b, 0xe38f9eab8f685827, 0x782b0bd5192bca87},
  {0xaebbaa0e79dffe28, 0xb3542e6782b8ce84, 0x8a972b1b32323be2},
  {0x62cbd1af5c77da14, 0x3bbc6119877bbc1d, 0x8b6d73bce65ed541},
  {0x4cd2ae2762f272cc, 0xdd4adc5bfc34ae6b, 0xa3f908a96f0fe449},
  {0x60cfbdb9b6447e24, 0x721af8263082c01c, 0x68cb54e6fc7104af},
  {0xa92867af3dc3b730, 0xb2608cc06efe34d0, 0xa3445078ace873ca},
  {0xeedad86c96afe677, 0x52afb525bd42562f, 0x38cf8ddb97dc96e5},
  {0x0a3b06f10bbc9562, 0x577b7a04e02c557b, 0x8be00f5765b7e908},
  {0xaa72b3916d207e20, 0x50f0cce86025ffac, 0x09f7f935bbde0a04},
  {0xac08b4e71f96174a, 0x16babbd24d02b260, 0x48e9d357af5ba717},
  {0xe122c9c16beaa8be, 0x07043902949cfad6, 0xf78fd47b58608577},
  {0x5c473c24ac8ca469, 0xb1da898afda7d7aa, 0xcac72d2cf21a9be3},
  {0x7da00b91479d06e3, 0xc4c76d79d51eb15a, 0xb6c2e5796630269d},
  {0xb42bb35d07e100ec, 0x19964fd51c07b0af, 0xffb88b0ef80a102f},
  {0x60e6beb41a673a07, 0x75bec86a6c06b470, 0x61bb7f05fc39be82},
  {0xfda48d0189cd0c13, 0x649054858d5374c9, 0xb770a8503a32e8a4},
  {0x4a376d825f3006c4, 0x8896eb44124e97aa, 0x70e626bebfff29b5},
  {0xe37a2f298ccf89c0, 0x3c3609a866d94979, 0x356c25d15f10d784},
  {0x458ca204a347e41a, 0x59568e0a4da4e181, 0xab475a7c61d9014c},
  {0x8c1a39eb79672160, 0xb373d43893fbd9fe, 0x41ba8d6a7097e9c8},
  {0x7c01434b5f8e1448, 0x662bd055a2512d4f, 0x652c31c38e992dbc},
  {0x1eae5c36fe075219, 0x82cb682598bcb1ea, 0x60daaa526a3e9947},
  {0xf7ab17ab10f03bdf, 0x1e124b56f71a4c37, 0x75df607068cfdcff},
  {0x1ffe54ada576e3c2, 0x384cb4e86120aaa8, 0xc6a4fefc642071df},
  {0x1ae57be1013b7efb, 0x28d36534e13a369d, 0x75612cd220210f77},
  {0xa84cfbb045298f2b, 0x733fdf0216082f1f, 0x0054b363e1fcdb09},
  {0x8745e66041e62570, 0x980a16636c09d9b2, 0x51695306d0539b47},
  {0xa67319655b027ef6, 0x4fd02799c207267a, 0x01587af4a65b6fd2},
  {0x8d991698735bcc88, 0xf14dbd2b19f99a78, 0x6947a3b95199d2f4},
  {0xe2906490948e4aff, 0x16b2ee7035d98706, 0x78f47845853b1ddc},
  {0x58d9cdc2dd693cd9, 0x7e9c240b1b252019, 0x5cbd3d458a53ca24},
  {0x24101759ff01d89b, 0xed8fdd27cdb2d47b, 0x11b0fa26e8d8a743},
  {0x9da3e8ee96db2f59, 0x68285801543b4ac8, 0x618cc8ad53d51b65},
  {0xf0b448478f472d56, 0x6044053c293513d2, 0xea2fb63a575a34cb},
  {0x56bd7f9b430ca7de, 0xf883dbb4c18d2e0b, 0x6c8030ef1a38c730},
  {0xf2e2c1396125acce, 0x882e926d399fcc33, 0x87e914f3049f22ce},
  {0x7ec0b0443f81915d, 0x4573c52a818a44f3, 0xafc01f5cc8120f6b},
  {0x924aed58bfbc33f1, 0x7cbf5617448b59a8, 0xef023ef380d782bb},
  {0xed78ebbcc2543624, 0x4fbdf96f5a481d8a, 0x7dea022c85973850},
  {0x4cd0fda73b73aaf8, 0xab714c84882fc5a6, 0x31a12db8b87c1a82},
  {0x4f55b122e52b04af, 0x2b6abc206fcdea22, 0xeecc6a28e10f3cd9},
  {0x773b7f263618ea81, 0xfedd6644251162ff, 0x20f124b39fffa2ef},
  {0xc86672d34c7f9c99, 0xa1a9bedd91ba54ab, 0xe3164453cdbc1680},
  {0x976193445cc61080, 0x4e8af4d9771f7fde, 0x2d6951afbad5a152},
  {0xac8104ed45afc3e0, 0x2daa407aee0854a8, 0x93bf8a5f6332934b},
  {0xadacd0145616a90f, 0x18fcdf471f8e446e, 0xb6cb1d657c5aee1f},
  {0x39f4888a9f625046, 0x714ced776be006aa, 0x301aab64f4c07bac},
  {0xfed94c87075ec99b, 0x6527495efabe5878, 0xae4ed05b44c346fa},
  {0xe8089970ab84a9ad, 0xfa8ef420f612f142, 0x3033e1b424799c03},
  {0x3de830d471a1c303, 0x1d4648963e64b5e8, 0xb7fc69c1308d744f},
  {0xf917cc81a21178a2, 0xf51c71d20d3dde0f, 0xc755e70d903eca43},
  {0xf988b4435c7e0659, 0xe8ec12c9411e644d, 0x011cff135dc46fe5},
  {0x45eb42b4bc82e615, 0xbb1ea1d87fa2dcc8, 0xbbf258cddfcc5a4e},
  {0x76c177c889777fa3, 0x771de5ab30476eca, 0xe3dd4d0ea4da4f41},
  {0x62d43190a74afaab, 0x8c72e6cc25a0906d, 0x6560641e35c269c1},
  {0x4a473706039e3353, 0x9270c15446432105, 0x508bd6dfcce33617},
  {0x58e979ef836cb200, 0x64a108a5f68530dc, 0xeeb5a210610292b9},
  {0x3e8a485122657a2d, 0xb7f7272f3423621b, 0x4c0e2f899ffc6f0f},
  {0xb03f26ebad2101f3, 0x2bf27f00ccb827ad, 0xf2c32d1c9db42e29},
  {0xcc5f196397e2bb63, 0x9cf1f95bba0e5fb0, 0xcffa723b8add78c2},
  {0x5198cabd81774aa6, 0x79e142bd7c3981f1, 0xcfb65a6d42815d8a},
  {0x91dc7af311207622, 0xf294a4f3c38f447e, 0xdfd67624b63f7997},
  {0xfb2f51ed0b5b44c1, 0x6eeb2b229427682c, 0xfad555a3f1680200},
  {0xd043eb034f7557ae, 0x89f917e3d7f663f1, 0xd7f51e2f59ce0302},
  {0xd1738764ddee76f4, 0x28a966bea5ec647e, 0xa322c656d7bc27d1},
  {0x0cd66c8dd29514f0, 0xb4e37bf2f01130a9, 0x7db6ecdc81a7a57f},
  {0xc8cb28a44796dc78, 0x88eb0048501b3765, 0x8ff3fbd6d703c26d},
  {0x2c5d68650ca4b6f5, 0xa8e391ce83198344, 0x8b9f3219506be9d0},
  {0x911906127a1ba855, 0x30d5215961ac95e7, 0x71827dfac7504342},
  {0x1ae4c2e2506d0712, 0xb5caffb8afbcda6e, 0x159080539f7f876e},
  {0x86571676f6228cdb, 0x3a51f0bfed40380f, 0x5dec5a0cee962a54},
  {0xf5c3339c01460504, 0x5d55382d4e349ecc, 0xcf81cc12df0b2c9e},
  {0x89a775997037437a, 0xc86002223b57f27f, 0xfe795feb841f08ef},
  {0x7da8a9b3f9f43fe4, 0x8494d51c6e215f43, 0xb703f044bc338b9c},
  {0xf73c2c9d450a092f, 0xce0ae97084884a01, 0x9a647f6d5f970839},
  {0x87c63573f869cdbb, 0x812d2d8e966e6911, 0x973b425ba1c66dfa},
  {0x7de5a1e78d630e85, 0x765d7d5a4a6e3cb7, 0x28170eef2a846d99},
  {0x0b0c630c0f59460d, 0x9c8758a9ee8db258, 0xd3589f9c034f75d5},
  {0xe1a6d8e757067309, 0xd18498099be244d9, 0x9b10a894502fc4e1},
  {0xfa14fe8a1dd59c3e, 0x6a9a93b0f1ac862a, 0xdbe4d8d065053ef7},
  {0x5c94965ff0a8e28e, 0xc2a32a0d57f1faa2, 0x24dc5effe1fa9e37},
  {0x6b404bba72a24d04, 0xbcd23a38f7981241, 0x93d0c9eb1b9a39ef},
  {0xa53a198b9e74e59c, 0x17cb3bc05f9608d1, 0x21bcc23eb5e75655},
  {0x05911f7d3220397f, 0x7915054dcb628314, 0x183a2a8400570cef},
  {0x2a420bf34788186c, 0x8c83a2945ee3027b, 0x606a65c37a8f2fe3},
  {0xccf4e83131d54a27, 0xc95466a498499126, 0xef9ac8206968b1f7},
  {0xe457b2ff12256f1e, 0x57fd60a454e5f68d, 0xf3388bb1de5dd1c2},
  {0x4addb3e322595749, 0x39e02bd59d8ae504, 0x20284c1ae2f1a65c},
  {0x9fbb5574795cac4d, 0x9fedac975974c8bb, 0xd307ecf05fd4fd22},
  {0x2505bb81200f8cbb, 0x2ac9d93c45830708, 0x11ec704af2c49861},
  {0xfa1702dd351d3b22, 0xbe0dfc13d607f962, 0x82c611b8ccd1e9f2},
  {0xb7ff038d58626bd7, 0x86e990a7d6acad3b, 0x5010d30fbe2d70a9},
  {0xc42bda459ef1afca, 0x83c5891e3eff20a0, 0xdefbb485c364fd5a},
  {0xaada4d9f943df0f1, 0x2618e51a8838b5fe, 0x8f45f0ffff45201f},
  {0xb55e3891213f972c, 0xdb4f56b16dc4e905, 0x30fd462a4cf268fc},
  {0x64e007b7010e8c80, 0x2d0de3d26a1748c3, 0xa2e01ed12648c113},
  {0x5128d2b5c4bac674, 0xb80b46283a340508, 0x1c1f01fe24b17a66},
  {0x4cb8ab976733595f, 0x403aca262ff117b0, 0xce1698b4f9a54376},
  {0x7781e71d8805fdc4, 0x40c3c2110800e7a0, 0xe72e9e63999cc311},
  {0xbb3e3e6501e45c00, 0x9e70bd7de6780a3b, 0x549416aa087fe4c5},
  {0xae1da809d7eed055, 0x06ba5804e029b01c, 0x490555c99e76bd05},
  {0x67f3afbbfeee6547, 0x1243b190c38432b1, 0xbab2fa8df7bf2943},
  {0x6d7197464f15c83c, 0x9283ced1147a6a85, 0x96ba1a0e47d9dd96},
  {0x9cbb90e485218006, 0x8b5ff83a0210b4d9, 0x1086afcf143b95c2},
  {0xa07d026b378f963b, 0x2debd80b456cd3e3, 0xc7792b9bc7f54c4a},
  {0x3d0bec8b88ba06b8, 0x0c13cdfdc4d01e9f, 0x6d256d1087b9c95e},
  {0x9216a33ea47259ff, 0x2bde0cfcb54abe8d, 0xaaef421825f1b47b},
  {0xa1aabb09b181ae0f, 0xc14d44d54e3620cd, 0xabb20e2a4d637bcb},
  {0x2544eba1038d1b04, 0xda1f84aa9bc120c2, 0x41fd7f657a18c45d},
  {0xadaff973f301d8c3, 0x87dae306486ff1a6, 0x60ec280a2570b8ff},
  {0x624994b2704d4c20, 0x532232f1cf209482, 0x861b9c2a5a7d0a43},
  {0x4513aa7db58aea4d, 0x89dfbe8c94798dde, 0xe735f37739441c13},
  {0x2f534ce65fbe5d87, 0xf8fcb2432339f543, 0x8ea957572a77e395},
  {0x2456c8d764e7c1a6, 0x7dc7567c507e2e18, 0xd29b13c5db1cd65a},
  {0x885705a845bb1199, 0xebc702d7e1680421, 0x9aeba22f533cbac9},
  {0x55c435f803ad3742, 0x695442fe576b3a09, 0x5ca02fab230ee023},
  {0x0d446bb06a3cbf8b, 0x5bfc8414d84fff9a, 0x157e3384708408a8},
  {0x7b212d17c02a4054, 0x2b14562733ba6900, 0x7965f7d93122eac0},
  {0x349446294451df24, 0x2b91f57cdcc289f3, 0x829cb5a03cce767d},
  {0x2f8e7fa84f0ad401, 0xb3a50f68cba8a638, 0xde440882f84bfd7a},
  {0xd1ba1db41829f412, 0x9a2c4c23fb8538f7, 0x86ca32d92d99ecb9},
  {0x8a6db99a627b227c, 0x633c81cf8e52a687, 0x8e58542594d7103e},
  {0x4c5a928b8610d6cd, 0x6a38a81e5ec41b61, 0x05ac22b201c86322},
  {0x283c4b53c14f39c0, 0x106fe171df2218c5, 0x4c077d33f17e0107},
  {0x198b4c90bd33552f, 0x5853a4c2f74596db, 0x1018dd6bf21150d4},
  {0x47c29e1c2f495b4c, 0x7ec84995131d545b, 0x49e53beaeb94dae0},
  {0x2678b3f7b548fc9f, 0x63a6b9322f3a574c, 0xef6d85f1091f1aeb},
  {0xf1391f569cd5fe90, 0x876e8ba956de0238, 0x6cd576e3b8ab6222},
  {0x827547465967b775, 0x4197e1290368e412, 0xee63a7ef2156fb67},
  {0x6cb2a919735b34d5, 0x6cc967b756d72395, 0x9a884a65ae74e811},
  {0xbdebcb5fbfafafc0, 0xb7fc62a4c7947030, 0x554c36728822d8b6},
  {0x025fef80c960792a, 0xc0f487dcc0ad8059, 0x9714504680995ad0},
  {0x19ffb11f02502666, 0x482fc0fae8608ad2, 0x781175f6049c62ee},
  {0xf1fece4f515854e7, 0x6dab52f7b6560106, 0xfa0028f50d672954},
  {0x844afcd287c1ddba, 0x47234b529fe3ca41, 0x3ca221c08f88140a},
  {0xfdbbeaaa02badeda, 0xf35a5e21992e2332, 0xa37f6d68d919b65f},
  {0x6d218f603725748a, 0xb6df3c61103e9c3e, 0xbb7ac1cf4c1f4692},
  {0x8e6d3eb058cfc260, 0xfbe2f6497287731a, 0xffa78646830d5ce0},
  {0x8c07c328df449acd, 0x500ba217a7af529f, 0x19ab11b99a1a2a19},
  {0x42de87a6001d7bc4, 0x6d65941a9ae5138b, 0xcb830271914ce1ee},
  {0x25f950eb4e2b9669, 0x0c9f7a2279a16278, 0x86503e9de2e76202},
  {0xedc0f3a86b732556, 0xc7995c7b3ec0ea66, 0x8a4d95b8d19c29ce},
  {0x01b5ab0eca4d3189, 0xed7898b982b519ad, 0x24c5f841a769f11b},
  {0xde3eefe1bad32178, 0x493a735c30942df4, 0x8b5ec5bed8e4d565},
  {0xa974a9d616b752fa, 0x09d37b2ab193ca1c, 0x55b8aaf3af4481ba},
  {0x84ca6915121b1e09, 0x8831e83e34fac643, 0x05e3db5a89049a2f},
  {0x5375a9f4aefd0f44, 0xaf272fd031366078, 0xbbd286c07ed80632},
  {0x9d101a493aa2ebc9, 0x67e3ddfaa73b2b94, 0x45bf06b13a5d6856},
  {0x6469dfeed8b766bc, 0x41a958a8c84553fc, 0xc3665b3f060a6808},
  {0x8bbd23b38d0cff32, 0x891f48bb2592fb3f, 0x24c6243ad065453e},
  {0xf3d1cc12dcb4e302, 0x588dfaa464f518be, 0xfe082e8b4a39cf26},
  {0x95c521746547be8e, 0x9cbbea72400d1df8, 0x0cfdac076655d579},
  {0xa6c4c57375f48495, 0xd63f47b41907a3f7, 0x34e17c2df60668d7},
  {0xa135ca38c26b95c3, 0x2aac9c6b01173258, 0x2d8499bf2ed7c23c},
  {0xba02892976144352, 0x9e4d9906dc2ae94e, 0x6535b5091d0535a4},
  {0x6ec4dba2c6f7e949, 0x02d65b71f7db3f86, 0x61c796b0290e7ff0},
  {0xac044d22d442ff2e, 0x29d00d9db764b6ff, 0x9ec4ff5f21f3216d},
  {0x26b3c84573c53161, 0xa3037316e91bf8bb, 0x251ed327edf11e39},
  {0x2917804d2422970c, 0x16119362ba8934be, 0xafa94e1359c77cce},
  {0x4eac35ec04e84a0b, 0x31b309e5e5d361a5, 0x4171e00956fd334e},
  {0xa02b9fdd9f6b8162, 0xabd8bc110f4e1f52, 0x75578ed77238fedc},
  {0xe73f9ad96bd8686d, 0xbdfc49ed2dba8097, 0x054c4bb989c34404},
  {0xa0d01888aa5b1042, 0x8c33305a0dc075b1, 0x75f81fe0369e7b86},
  {0x679d711aa88faab7, 0xb03f74deaa29c24c, 0x10a7766990689f5a},
  {0x827d13e4d6310b6b, 0xc5a73641d06e47d1, 0xf2f0d06e14e2ab1f},
  {0xcc968649ec63f05e, 0x17cda3a7fc25bfb2, 0x0df1338db25ee18e},
  {0x7d4acd6c3cf8c18b, 0x4bd734fd562d48ad, 0xae50c4f72f542533},
  {0xcf438bf70dbe4c62, 0x0019bcea28ce9270, 0xf687acda7ff8c960},
  {0x5b24783c5318fd09, 0x5623189d31422de8, 0x862fd585eeb3e3f0},
  {0xf98482f8df7d5e16, 0xccb9fb2d3745fbbf, 0x7d5e1bd364daa7d4},
  {0x024849574a40a831, 0x48cae56880d67329, 0xfafa85469a93e6b3},
  {0x944eae6b760bc534, 0x1d1d18f30fec24c3, 0xc64a74b4d0c3181e},
  {0x19c52990a4e62d2d, 0x37b473c7ed759ef9, 0x04080c0ade3df738},
  {0xfcc4062c7876c075, 0x48b4cf0b72aae741, 0x3889eef0b66c1bff},
  {0x49c26471ae06da0b, 0x109da4749a70108b, 0x443b50c74915bd54},
  {0xbe68bd432e672eb8, 0xbe737af593618ab7, 0x5d537d8c0da1a4e7},
  {0xa3ca7393ce4e8d7c, 0x0fcf46d53a057c21, 0x7451a590ca6c1db1},
  {0x79419444b1c149e5, 0x9d577a1e13240b2d, 0x24da1fd0d5db6e4d},
  {0xe8c3caf37ad5170c, 0x423b4593d3f4c834, 0xff039eaad5042ae3},
  {0x3bf5913b5615f7f5, 0x2d24b840238f2c84, 0x97bdc5bfeb1d53b7},
  {0x53538b2293df4606, 0x169029e2d8675ec6, 0x9ab1ac25ee4982a4},
  {0x75bd284d07f591f8, 0xccdd36b98d68786e, 0x9321ba79d2e56eed},
  {0xe63236d17de7e69c, 0x9600d5f5cca5b08a, 0x8ff14c81e5d61843},
  {0xdb079962536683c6, 0x35bb6068eb26bd37, 0xa614c37971ca2e4d},
  {0xab78167ac83c4064, 0xb6a1928d6f89cdd1, 0xc97cc61d01ffe82f},
  {0x83e6edd7a512e8b7, 0xe281601e537bc4ec, 0x19d35d2d57518cde},
  {0xf737f3ddfa7fc9b2, 0x4a8f04a9cb4847be, 0x2946f3355994de91},
  {0x577ca3baf1f7e1ba, 0x446729b10c51ed7c, 0xab637d9c6e3a5554},
  {0x4e31798071664def, 0xec15c968e363630d, 0xd7ce5f867f758e48},
  {0x10525e76bc5a5ed9, 0x1c8a384248ab4398, 0x8f7a522f2e2f3fc5},
  {0xdee25133572d24bf, 0x37203f7f6c2e0e36, 0x89ba27d9b1233156},
};

#define GF_exp_invmer_e_1 AIMER_NAMESPACE(GF_exp_invmer_e_1)
void GF_exp_invmer_e_1(GF out, const GF in);
#define GF_exp_invmer_e_2 AIMER_NAMESPACE(GF_exp_invmer_e_2)
void GF_exp_invmer_e_2(GF out, const GF in);
#define GF_exp_mer_e_star AIMER_NAMESPACE(GF_exp_mer_e_star)
void GF_exp_mer_e_star(GF out, const GF in);

#define generate_matrices_L_and_U AIMER_NAMESPACE(generate_matrices_L_and_U)
void generate_matrices_L_and_U(
        GF matrix_L[AIM2_NUM_INPUT_SBOX][AIM2_NUM_BITS_FIELD],
        GF matrix_U[AIM2_NUM_INPUT_SBOX][AIM2_NUM_BITS_FIELD],
        GF vector_b,
        const uint8_t iv[AIM2_IV_SIZE]);

#define generate_matrix_LU AIMER_NAMESPACE(generate_matrix_LU)
void generate_matrix_LU(GF matrix_A[AIM2_NUM_INPUT_SBOX][AIM2_NUM_BITS_FIELD],
                        GF vector_b,
                        const uint8_t iv[AIM2_IV_SIZE]);

#define aim2_sbox_outputs AIMER_NAMESPACE(aim2_sbox_outputs)
void aim2_sbox_outputs(GF sbox_outputs[AIM2_NUM_INPUT_SBOX], const GF pt);

#define aim2 AIMER_NAMESPACE(aim2)
void aim2(uint8_t ct[AIM2_NUM_BYTES_FIELD],
          const uint8_t pt[AIM2_NUM_BYTES_FIELD],
          const uint8_t iv[AIM2_IV_SIZE]);

#endif // AIM2_H
