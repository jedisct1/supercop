// 20240806 djb: some automated conversion to cryptoint
#include <stdint.h>
#include <stdlib.h>
#include "params.h"
#include "poly.h"
#include "reduce.h"
#include "rounding.h"
#include "symmetric.h"
#include <string.h>
#include <time.h>
#include "packing.h"
#include "./sign.h"
#include <stdio.h>

#include "crypto_declassify.h"
#include "crypto_int32.h"
#include "crypto_uint32.h"
#include "crypto_int64.h"

#if NIMS_TRI_NTT_MODE == 1
//N = 1152 = 2^7 * 3^2
//Q = 8401537
//zeta = 174396 //(2^7*3^3)th root of unity
//invMONT = 4009235
//invzeta = 6214534 
//W = zeta^(2^7 * 3^2) = 4804004
#define MONT 1781889 // 2^32 % Q

#define Wmont	1857311 //mont * W (W : 3rd root of unity)
#define W2mont	4762337 //mont * W^2
#define	F1	5143946 //mont^2/N
#define F2	1886355 //2 * mont^2/N

#define radix3_len 3 //radix-3 2번
#define radix2_redlen_ntt (N>>8)
#define radix2_redlen_invntt (N>>3)
int32_t zetas[1151] = {
	3639200, 2686861, 6424568, 6554301, 7526435, 877607, 306698, 4659475, 2808328, 1552595,
	1424358, 2775436, 5524170, 1878681, 6481742, 3390155, 4282716, 2116573, 5543577, 3460077,
	432998, 6433532, 184706, 5190529, 8309856, 907034, 1179760, 8184262, 2536834, 4693847,
	4814234, 180498, 4004427, 2486172, 1251, 2440877, 3564940, 6469915, 7099282, 2162462,
	1524716, 7594467, 3264673, 8348313, 5056889, 3125966, 4070954, 5394914, 1732710, 1054835,
	8089830, 1595450, 7283296, 5691488, 5642710, 6112046, 88822, 6502665, 4068162, 3845994,
	801959, 8233299, 7392628, 3132507, 7290507, 1957344, 6032763, 1485307, 3001095, 347708,
	7922675, 7044727, 4274417, 2831444, 1643646, 8315960, 1758450, 4932998, 3590231, 4706816,
	3277849, 4050420, 7601909, 5145204, 7823061, 959142, 33147, 5706219, 5641511, 7716605,
	2768240, 662643, 6249357, 7628050, 4602216, 35121, 74136, 2427534, 7254923, 128776,
	6297943, 418975, 6436867, 5925628, 6136950, 6663782, 1962506, 5391729, 5785737, 5281972,
	2650439, 821034, 6317452, 4418807, 4770462, 2888434, 3205705, 1652755, 966215, 7352241,
	989379, 6977760, 3823033, 4378563, 814504, 3440373, 1721,
	166697, 6845588, 3919256, 3438345, 3723422, 1882396, 3547575, 1555949, 6400991, 3281506,
	2809088, 1173945, 1253810, 4455451, 3989177, 5120031, 2762523, 2497947, 5640971, 5241189,
	259380, 7739136, 5659819, 5903590, 8164013, 4626509, 5067109, 5700756, 4870071, 1925728,
	1335085, 3775028, 6000207, 3986235, 6301921, 5153193, 2235158, 737891, 8223422, 4415302,
	3844299, 2372245, 8227131, 1203793, 7548598, 3576038, 7192649, 6029292, 7355171, 4185321,
	1311251, 924531, 2222840, 5109852, 4514923, 4216216, 8025058, 6796594, 273132, 5125424,
	7441504, 3520481, 3600911, 1604943, 6786372, 5073513, 3965136, 7052183, 130820, 3724159,
	8163426, 3328024, 4794542, 3390860, 5221396, 6921825, 4607652, 1911148, 6576914, 5010677,
	514029, 3935336, 1328031, 4486445, 3824161, 20244, 471459, 4466201, 5324318, 5560875,
	7777014, 6127693, 7613357, 3287031, 837334, 2840662, 913651, 4403202, 2603493, 5034447,
	126705, 1036112, 97875, 3998335, 433968, 1504803, 1846049, 2324173, 2922670, 3828976,
	7083542, 6896734, 7639038, 5784777, 4320431, 252265, 1995241, 6037042, 2207645, 2616760,
	1674074, 2786635, 6194638, 5032277, 8028620, 7818912, 6609610, 5614902, 1672121, 5236652,
	88165, 6884768, 730565, 3719883, 5051056, 3164885, 5366704, 6982292, 2280675, 7058482,
	6838596, 5639237, 1624362, 1419245, 4965202, 8038247, 1128088, 4667850, 3278486, 4304560,
	5814750, 363290, 7433838, 6240075, 35252, 5924414, 4768038, 3762952, 5166111, 2161462,
	5215641, 4042892, 2836346, 1013632, 7643252, 5056524, 693331, 4358645, 4663564, 5484672,
	2565047, 6782582, 4698106, 3865717, 3748470, 2916865, 1084779, 6228893, 3574146, 6979264,
	5502127, 4806620, 2032195, 2172644, 1082847, 2591025, 5934871, 5723287, 7768152, 8314312,
	8349902, 5810512, 5525650, 6692897, 5969160, 5057514, 2349929, 3348874, 1012578, 1708640,
	2857261, 2377575, 7805834, 7061874, 7920304, 1037912, 5198125, 6023962, 146560, 4014599,
	967589, 1394046, 5559678, 5408645, 7945891, 4386938, 5427915, 4293417, 6435730, 3940482,
	2809349, 8233899, 6825926, 4108120, 7566859, 1313441, 4278600, 3090802, 6155990, 4404243,
	4901487, 7088096, 485894, 5729593, 4574612, 6595564, 6978853, 3923620, 2087784, 2671944,
	5369630, 3926154, 3027904, 2190967, 6389872, 6117121, 4049739, 4475383, 1099759, 3345374,
	3104, 7571714, 230125, 2515551, 5404480, 5056163, 6665025, 1055950, 5397364, 7983055,
	8357888, 3421184, 4410150, 4092812, 1416683, 7195496, 5728828, 6185265, 7779633, 2216272,
	869976, 7513996, 5677537, 7345587, 7289392, 8251446, 7040902, 5766783, 7670156, 4308725,
	6768989, 6272686, 5312884, 1804128, 4912184, 5236045, 1525494, 5379350, 7224001, 5838419,
	8032750, 4157775, 6366809, 4243762, 1463651, 2213858, 1286086, 2128851, 1998401, 3709568,
	350843, 5961903, 5982363, 3022187, 1729880, 1444848, 2867333, 2520659, 8114824, 8176527,
	5619998, 7414630, 5451998, 8157324, 891074, 3019018, 2884256, 5382519, 1623184, 7189620,
	1780643, 6956689, 2037329, 1200635, 5795677, 5539677, 6705351, 986907, 5544997, 7293981,
	7269149, 822304, 1272183, 6331963, 8248400, 7784199, 2850064, 6730950, 5995097, 7818575,
	6785547, 582962, 1610847, 5714625, 1972010, 1107556, 3988549, 5623394, 6186475, 239342,
	4137664, 617338, 6427198, 1761884, 7442507, 4347876, 146701, 4587787, 2338904, 325165,
	4336178, 2939034, 7937225, 1332138, 1822626, 7069399, 544749, 4912952, 1389189, 6639653,
	7387824, 4700918, 7389544, 5680014, 7364226, 8076372, 5700908, 2689186, 3381791, 7807571,
	1186891, 6253391, 8398078, 3810723, 3050069, 1689658, 4760685, 7372983, 7110541, 1028554,
	7749009, 1662577, 461062, 5712351, 3916284, 4378844, 4563661, 6779017, 104652, 4590814,
	4911153, 8388112, 2257957, 4238909, 750546, 5876447, 2837347, 2591074, 7364365, 4845849,
	3895548, 6395666, 1272944, 2005871, 97634, 65984, 301773, 13425, 116406, 4832424,
	2604530, 2233038, 1618071, 5810463, 3682449, 7366625, 336813, 2140402, 2378882, 6161882,
	6856111, 3080743, 259546, 5753620, 7726772, 1461437, 694493, 6940100, 5320068, 841088,
	7229206, 1034912, 4902281, 4718708, 5084858, 3601839, 6490674, 5320794, 1560222, 3366627,
	6673736, 1387431, 5435217, 1456875, 4973489, 6802716, 676078, 3189565, 1048441, 7520903,
	7208192, 880634, 3156148, 8259591, 5084688, 5034910, 2426084, 6556192, 3834447, 506797,
	6168821, 1598821, 7425926, 3334575, 3057769, 2283912, 348882, 1539320, 494139, 5867745,
	7702617, 221956, 4621787, 2350794, 3870025, 6050743, 4531429, 7407065, 5033868, 5066962,
	1645681, 3556531, 1048954, 4634706, 3492407, 2533792, 4090292, 2867599, 6066303, 375767,
	3522876, 4806010, 2911167, 8130447, 8036213, 7256718, 4127023, 6726637, 4931633, 1674900,
	1565727, 4534920, 1659243, 5533938, 7030537, 1722780, 2986958, 7102404, 7086664, 271090,
	6661532, 8251647, 1433627, 4659462, 6534493, 2206251, 7579864, 545577, 7298144, 6773636,
	8123459, 1882877, 8069214, 6518660, 1169641, 2751828, 631538, 149890, 1554066, 6623746,
	3911736, 6542339, 4865068, 7855960, 5971606, 7552197, 1214256, 4675293, 5494430, 4274332,
	4724383, 7031319, 5691014, 7292838, 3937736, 3357277, 334192, 5044260, 1372155, 2904114,
	3492578, 849340, 6397371, 6443498, 1932093, 8032570, 1952112, 1370218, 5732876, 2529673,
	332153, 776340, 5769014, 5623332, 2209806, 5465102, 5787086, 4789376, 2758040, 5774153,
	7029097, 2627384, 7892769, 2686897, 4988024, 5871864, 6915676, 7319049, 6758531, 6550493,
	718978, 2936435, 905530, 7690598, 6502344, 8009749, 4402068, 317038, 6911650, 3694781,
	6016716, 5415336, 452555, 3207273, 7753405, 5194264, 7352045, 4011819, 7593818, 710939,
	1837278, 4704397, 5448151, 2815485, 5939777, 4706756, 5300999, 243836, 4940590, 1565819,
	7871804, 56413, 5492095, 44944, 877240, 4823119, 8188766, 2207844, 2102600, 6193693,
	311750, 101357, 8013418, 8157701, 5728214, 5066955, 1827084, 3773663, 7376204, 8356593,
	7402811, 3550421, 6279939, 5065101, 1667742, 1071664, 868824, 6227003, 6241571, 7572800,
	5983894, 7163505, 2613809, 1238032, 2194640, 7298667, 1106173, 4851116, 5052715, 2721684,
	7540196, 3827069, 6358048, 2174534, 2000622, 2002206, 386535, 5459951, 3151447, 7084159,
	5680212, 5912141, 1029201, 5179930, 8364935, 2725193, 6237576, 5676344, 5212315, 4594763,
	110922, 6399331, 6154074, 7182136, 4350830, 8185144, 4439090, 2489396, 6732205, 1930591,
	6753105, 4241250, 779309, 6020930, 5349334, 6917451, 6231802, 972083, 3167615, 2910987,
	6712821, 5490550, 4224895, 4536844, 8002439, 6470946, 4038844, 2902674, 8034990, 7152237,
	422949, 1484086, 5775104, 8368151, 7486873, 5486853, 99336, 5216654, 5161793, 3598049,
	5797824, 7265323, 3830902, 7598667, 8170391, 802870, 2405954, 413166, 125372, 33386,
	1794968, 7231937, 4605560, 4683983, 2154908, 4803488, 4949988, 3365037, 7792083, 1870695,
	2738253, 31351, 2169683, 3993044, 6367918, 1820338, 6361249, 4589212, 521183, 3812325,
	1521152, 4024395, 1094223, 5036500, 5198194, 5185375, 6893471, 6459907, 6938845, 4408493,
	7186745, 2752032, 7486996, 6048222, 3233448, 7000252, 3815064, 6617490, 387443, 4892947,
	6615927, 355439, 1253114, 8046098, 3417988, 5216205, 2207387, 5649505, 6402334, 7644979,
	4213423, 6403661, 316844, 1784047, 4142843, 3392613, 3309611, 51966, 295518, 120838,
	5265114, 6244362, 5517655, 1599226, 8316386, 1601446, 2896051, 6800091, 326103, 6365200,
	2634223, 5008924, 5678895, 4991839, 667587, 1653412, 7845810, 2157175, 5383208, 8131423,
	2978262, 4011609, 258976, 6005912, 3063667, 1064785, 2274526, 5456268, 3271346, 4050356,
	1675551, 4351181, 1097736, 7070697, 4083424, 270114, 5519289, 5186154, 2411258, 8061965,
	2079298, 7336752, 2746890, 15659, 6947179, 883906, 4155353, 892614, 5130846, 5562656,
	5970049, 6937875, 270021, 8333695, 438319, 67842, 318122, 6455270, 5418701, 8385878,
	3788125, 6953534, 1047748, 816064, 3295236, 2838881, 4154298, 7052845, 7488303, 3191435,
	2520594, 8379212, 6785910, 3791820, 5327580, 745503, 1100786, 4089772, 8281822, 4311765,
	8161022, 3769495, 560710, 1348692, 5702415, 7798348, 7355223, 7281207, 2916424, 4609717,
	1633202, 525574, 1105642, 2359345, 1641973, 1787803, 7001742, 7874901, 821968, 4494445,
	7595588, 7690642, 5571547, 710895, 3459109, 1261167, 6359710, 7875963, 7801679, 5020019,
	5449617, 1648450, 466968, 526636, 5098134, 2779781, 1332486, 2147861, 5805650, 2563232,
	6517875, 572186, 6293378, 4012364, 3941538, 1971968, 616815, 6429569, 3474086, 3135418,
	4175637, 5621756, 1739836, 6792145, 2251860, 4119829, 7688522, 7829351, 367439, 241443,
	4682997, 3212560, 6671437, 3226644, 2009336, 5052706, 7467958, 2144163, 915068, 6508849,
	2939820, 1892688, 1664987, 8279350, 5278158, 8160094, 204366, 2385606, 1895933, 1319872,
	6587455, 3348831, 5636171, 6679460, 2390628, 7457950, 3457582, 6879627, 4164448, 2107577,
	5873513, 2664537, 7044546, 3156780, 5600839, 5244757, 1894707, 585667, 4241348, 1722077,
	5184230, 942460, 7020864, 2213193, 7124957, 6293960, 6591521, 201694, 1711942, 3626816,
	1118915, 5782088, 6032329, 7171571, 4433273, 6323640, 5775317, 5117609, 6402647, 3283928,
	2557816, 4552122, 3106767, 8199843, 6111656, 6525334, 1985829, 342888, 496823, 1229966,
	5792942, 2848026, 6892148, 3122682, 891628, 2930021, 4736346, 7138788, 3961614, 86993,
	2235645, 4026841, 2277930, 4374696, 2713240, 1667272, 4023269, 5553511, 2711720, 2935019,
	333336, 7149523, 5175216, 1262749
};

int32_t zetas_inv[1151] = {
	5175216,1262749,333336,7149523,2711720,2935019,4023269,5553511,2713240,1667272 ,
	2277930,4374696,2235645,4026841,3961614,86993,4736346,7138788,891628,2930021 ,
	6892148,3122682,5792942,2848026,496823,1229966,1985829,342888,6111656,6525334 ,
	3106767,8199843,2557816,4552122,6402647,3283928,5775317,5117609,4433273,6323640 ,
	6032329,7171571,1118915,5782088,1711942,3626816,6591521,201694,7124957,6293960 ,
	7020864,2213193,5184230,942460,4241348,1722077,1894707,585667,5600839,5244757 ,
	7044546,3156780,5873513,2664537,4164448,2107577,3457582,6879627,2390628,7457950 ,
	5636171,6679460,6587455,3348831,1895933,1319872,204366,2385606,5278158,8160094 ,
	1664987,8279350,2939820,1892688,915068,6508849,7467958,2144163,2009336,5052706 ,
	6671437,3226644,4682997,3212560,367439,241443,7688522,7829351,2251860,4119829 ,
	1739836,6792145,4175637,5621756,3474086,3135418,616815,6429569,3941538,1971968 ,
	6293378,4012364,6517875,572186,5805650,2563232,1332486,2147861,5098134,2779781 ,
	466968,526636,5449617,1648450,7801679,5020019,6359710,7875963,3459109,1261167 ,
	5571547,710895,7595588,7690642,821968,4494445,7001742,7874901,1641973,1787803 ,
	1105642,2359345,1633202,525574,2916424,4609717,7355223,7281207,5702415,7798348 ,
	560710,1348692,8161022,3769495,8281822,4311765,1100786,4089772,5327580,745503 ,
	6785910,3791820,2520594,8379212,7488303,3191435,4154298,7052845,3295236,2838881 ,
	1047748,816064,3788125,6953534,5418701,8385878,318122,6455270,438319,67842 ,
	270021,8333695,5970049,6937875,5130846,5562656,4155353,892614,6947179,883906 ,
	2746890,15659,2079298,7336752,2411258,8061965,5519289,5186154,4083424,270114 ,
	1097736,7070697,1675551,4351181,3271346,4050356,2274526,5456268,3063667,1064785 ,
	258976,6005912,2978262,4011609,5383208,8131423,7845810,2157175,667587,1653412 ,
	5678895,4991839,2634223,5008924,326103,6365200,2896051,6800091,8316386,1601446 ,
	5517655,1599226,5265114,6244362,295518,120838,3309611,51966,4142843,3392613 ,
	316844,1784047,4213423,6403661,6402334,7644979,2207387,5649505,3417988,5216205 ,
	1253114,8046098,6615927,355439,387443,4892947,3815064,6617490,3233448,7000252 ,
	7486996,6048222,7186745,2752032,6938845,4408493,6893471,6459907,5198194,5185375 ,
	1094223,5036500,1521152,4024395,521183,3812325,6361249,4589212,6367918,1820338 ,
	2169683,3993044,2738253,31351,7792083,1870695,4949988,3365037,2154908,4803488 ,
	4605560,4683983,1794968,7231937,125372,33386,2405954,413166,8170391,802870 ,
	3830902,7598667,5797824,7265323,5161793,3598049,99336,5216654,7486873,5486853 ,
	5775104,8368151,422949,1484086,8034990,7152237,4038844,2902674,8002439,6470946 ,
	4224895,4536844,6712821,5490550,3167615,2910987,6231802,972083,5349334,6917451 ,
	779309,6020930,6753105,4241250,6732205,1930591,4439090,2489396,4350830,8185144 ,
	6154074,7182136,110922,6399331,5212315,4594763,6237576,5676344,8364935,2725193 ,
	1029201,5179930,5680212,5912141,3151447,7084159,386535,5459951,2000622,2002206 ,
	6358048,2174534,7540196,3827069,5052715,2721684,1106173,4851116,2194640,7298667 ,
	2613809,1238032,5983894,7163505,6241571,7572800,868824,6227003,1667742,1071664 ,
	6279939,5065101,7402811,3550421,7376204,8356593,1827084,3773663,5728214,5066955 ,
	8013418,8157701,311750,101357,2102600,6193693,8188766,2207844,877240,4823119 ,
	5492095,44944,7871804,56413,4940590,1565819,5300999,243836,5939777,4706756 ,
	5448151,2815485,1837278,4704397,7593818,710939,7352045,4011819,7753405,5194264 ,
	452555,3207273,6016716,5415336,6911650,3694781,4402068,317038,6502344,8009749 ,
	905530,7690598,718978,2936435,6758531,6550493,6915676,7319049,4988024,5871864 ,
	7892769,2686897,7029097,2627384,2758040,5774153,5787086,4789376,2209806,5465102 ,
	5769014,5623332,332153,776340,5732876,2529673,1952112,1370218,1932093,8032570 ,
	6397371,6443498,3492578,849340,1372155,2904114,334192,5044260,3937736,3357277 ,
	5691014,7292838,4724383,7031319,5494430,4274332,1214256,4675293,5971606,7552197 ,
	4865068,7855960,3911736,6542339,1554066,6623746,631538,149890,1169641,2751828 ,
	8069214,6518660,8123459,1882877,7298144,6773636,7579864,545577,6534493,2206251 ,
	1433627,4659462,6661532,8251647,7086664,271090,2986958,7102404,7030537,1722780 ,
	1659243,5533938,1565727,4534920,4931633,1674900,4127023,6726637,8036213,7256718 ,
	2911167,8130447,3522876,4806010,6066303,375767,4090292,2867599,3492407,2533792 ,
	1048954,4634706,1645681,3556531,5033868,5066962,4531429,7407065,3870025,6050743 ,
	4621787,2350794,7702617,221956,494139,5867745,348882,1539320,3057769,2283912 ,
	7425926,3334575,6168821,1598821,3834447,506797,2426084,6556192,5084688,5034910 ,
	3156148,8259591,7208192,880634,1048441,7520903,676078,3189565,4973489,6802716 ,
	5435217,1456875,6673736,1387431,1560222,3366627,6490674,5320794,5084858,3601839 ,
	4902281,4718708,7229206,1034912,5320068,841088,694493,6940100,7726772,1461437 ,
	259546,5753620,6856111,3080743,2378882,6161882,336813,2140402,3682449,7366625 ,
	1618071,5810463,2604530,2233038,116406,4832424,301773,13425,97634,65984 ,
	1272944,2005871,3895548,6395666,7364365,4845849,2837347,2591074,750546,5876447 ,
	2257957,4238909,4911153,8388112,104652,4590814,4563661,6779017,3916284,4378844 ,
	461062,5712351,7749009,1662577,7110541,1028554,4760685,7372983,3050069,1689658 ,
	8398078,3810723,1186891,6253391,3381791,7807571,5700908,2689186,7364226,8076372 ,
	7389544,5680014,7387824,4700918,1389189,6639653,544749,4912952,1822626,7069399 ,
	7937225,1332138,4336178,2939034,2338904,325165,146701,4587787,7442507,4347876 ,
	6427198,1761884,4137664,617338,6186475,239342,3988549,5623394,1972010,1107556 ,
	1610847,5714625,6785547,582962,5995097,7818575,2850064,6730950,8248400,7784199 ,
	1272183,6331963,7269149,822304,5544997,7293981,6705351,986907,5795677,5539677 ,
	2037329,1200635,1780643,6956689,1623184,7189620,2884256,5382519,891074,3019018 ,
	5451998,8157324,5619998,7414630,8114824,8176527,2867333,2520659,1729880,1444848 ,
	5982363,3022187,350843,5961903,1998401,3709568,1286086,2128851,1463651,2213858 ,
	6366809,4243762,8032750,4157775,7224001,5838419,1525494,5379350,4912184,5236045 ,
	5312884,1804128,6768989,6272686,7670156,4308725,7040902,5766783,7289392,8251446 ,
	5677537,7345587,869976,7513996,7779633,2216272,5728828,6185265,1416683,7195496 ,
	4410150,4092812,8357888,3421184,5397364,7983055,6665025,1055950,5404480,5056163 ,
	230125,2515551,3104,7571714,1099759,3345374,4049739,4475383,6389872,6117121 ,
	3027904,2190967,5369630,3926154,2087784,2671944,6978853,3923620,4574612,6595564 ,
	485894,5729593,4901487,7088096,6155990,4404243,4278600,3090802,7566859,1313441 ,
	6825926,4108120,2809349,8233899,6435730,3940482,5427915,4293417,7945891,4386938 ,
	5559678,5408645,967589,1394046,146560,4014599,5198125,6023962,7920304,1037912 ,
	7805834,7061874,2857261,2377575,1012578,1708640,2349929,3348874,5969160,5057514 ,
	5525650,6692897,8349902,5810512,7768152,8314312,5934871,5723287,1082847,2591025 ,
	2032195,2172644,5502127,4806620,3574146,6979264,1084779,6228893,3748470,2916865 ,
	4698106,3865717,2565047,6782582,4663564,5484672,693331,4358645,7643252,5056524 ,
	2836346,1013632,5215641,4042892,5166111,2161462,4768038,3762952,35252,5924414 ,
	7433838,6240075,5814750,363290,3278486,4304560,1128088,4667850,4965202,8038247 ,
	1624362,1419245,6838596,5639237,2280675,7058482,5366704,6982292,5051056,3164885 ,
	730565,3719883,88165,6884768,1672121,5236652,6609610,5614902,8028620,7818912 ,
	6194638,5032277,1674074,2786635,2207645,2616760,1995241,6037042,4320431,252265 ,
	7639038,5784777,7083542,6896734,2922670,3828976,1846049,2324173,433968,1504803 ,
	97875,3998335,126705,1036112,2603493,5034447,913651,4403202,837334,2840662 ,
	7613357,3287031,7777014,6127693,5324318,5560875,471459,4466201,3824161,20244 ,
	1328031,4486445,514029,3935336,6576914,5010677,4607652,1911148,5221396,6921825 ,
	4794542,3390860,8163426,3328024,130820,3724159,3965136,7052183,6786372,5073513 ,
	3600911,1604943,7441504,3520481,273132,5125424,8025058,6796594,4514923,4216216 ,
	2222840,5109852,1311251,924531,7355171,4185321,7192649,6029292,7548598,3576038 ,
	8227131,1203793,3844299,2372245,8223422,4415302,2235158,737891,6301921,5153193 ,
	6000207,3986235,1335085,3775028,4870071,1925728,5067109,5700756,8164013,4626509 ,
	5659819,5903590,259380,7739136,5640971,5241189,2762523,2497947,3989177,5120031 ,
	1253810,4455451,2809088,1173945,6400991,3281506,3547575,1555949,3723422,1882396 ,
	3919256,3438345,166697,6845588,8399816,4961164,7587033,4022974,4578504,1423777 ,
	7412158,1049296,7435322,6748782,5195832,5513103,3631075,3982730,2084085,7580503 ,
	5751098,3119565,2615800,3009808,6439031,1737755,2264587,2475909,1964670,7982562 ,
	2103594,8272761,1146614,5974003,8327401,8366416,3799321,773487,2152180,7738894 ,
	5633297,684932,2760026,2695318,8368390,7442395,578476,3256333,799628,4351117 ,
	5123688,3694721,4811306,3468539,6643087,85577,6757891,5570093,4127120,1356810 ,
	478862,8053829,5400442,6916230,2368774,6444193,1111030,5269030,1008909,168238 ,
	7599578,4555543,4333375,1898872,8312715,2289491,2758827,2710049,1118241,6806087 ,
	311707,7346702,6668827,3006623,4330583,5275571,3344648,53224,5136864,807070 ,
	6876821,6239075,1302255,1931622,4836597,5960660,8400286,5915365,4397110,8221039 ,
	3587303,3707690,5864703,217275,7221777,7494503,91681,3211008,8216831,1968005 ,
	7968539,4941460,2857960,6284964,4118821,5011382,1919795,6522856,2877367,5626101 ,
	6977179,6848942,5593209,3742062,8094839,7523930,875102,1847236,1976969,5714676 ,
	968342
};

#elif NIMS_TRI_NTT_MODE == 3
//Q = 8397313
//zeta = 86054 //(2^9*3)th root of unity
//invMONT = 4329369 // 2^(-32) mod Q
//invzeta = 1755596 //zeta^(-1) mod Q
//W = 5661571 //zeta^(2^9) mod Q
#define MONT 3940353 // 2^32 % Q

#define Wmont	1050121 //mont * W (W : 3rd root of unity)
#define W2mont	3406839 //mont * W^2
#define	F1	2250740 //mont^2/2^9
#define F2	4501480 //mont^2/2^8

#define radix3_len 1 //radix-3 1번
#define radix2_redlen_ntt (N>>8)
#define radix2_redlen_invntt (N>>3)
int32_t zetas[511] = {
		4990474, 3227855, 2268138, 972348, 2337085, 124959, 4479337, 3667838, 5689912, 6644273,
6934194, 6934665, 1538485, 5896473, 152433, 971564, 6152987, 6328434, 6948882, 574790,
1459554, 5672534, 2982539, 383382, 2182644, 3631088, 6117417, 3514437, 3273452, 4262990,
2598551, 2624740, 3204729, 7745421, 1375023, 171112, 5348856, 1032490, 4589664, 2395811,
8343591, 6071282, 7365101, 4401765, 3583379, 2167158, 2285110, 5289144, 3923560, 7953169,
6722707, 4715825, 6465037, 5854021, 3783550, 5071907, 7765640, 892445, 6144516, 240402,
349876, 7886275, 4087106, 1235584, 7011869, 7497916, 4385583, 5168591, 6832874, 240718,
7123460, 3247067, 2567789, 70496, 656034, 1873626, 3512977, 1195040, 413771, 1924321,
655407, 7136014, 4078101, 476272, 2621588, 3456051, 8154728, 1434739, 7591357, 1545373,
7524556, 4408881, 395308, 2362032, 2300880, 4839465, 6374899, 4099598, 5945650, 6595643,
2290135, 5221968, 132753, 7121619, 3771421, 8169963, 4758324, 3398805, 375361, 6746501,
7808337, 3951210, 7984859, 2721906, 911361, 4486605, 4515839, 6133174, 4398986, 42606,
5516164, 8006412, 4059425, 6710531, 1783116, 3836780, 8104958, 4584505, 7432834, 3234870,
6858061, 4934201, 6097734, 4201686, 6901396, 8050176, 383341, 2806294, 6185977, 5867038,
2614166, 6786110, 2655361, 5533954, 4583186, 4546610, 430326, 3064313, 6284076, 6224373,
6963213, 7190978, 2271090, 6422994, 8213843, 2771607, 6190754, 6025246, 8046867, 8302794,
570546, 1327008, 6745812, 547559, 4076162, 5273742, 3184165, 4293535, 1289247, 6071198,
2375675, 1099499, 7458138, 2985263, 1376941, 1651505, 3963832, 7439099, 2260402, 8373167,
4117372, 3162151, 1919551, 621337, 1739534, 355419, 907301, 4746577, 7254367, 8041444,
4753267, 8285032, 6005209, 3191271, 1740753, 4591869, 8178904, 264532, 2479834, 5802854,
6196469, 1672317, 2149662, 117314, 3237267, 8013170, 370, 8179771, 4319762, 2114157,
4927297, 4393190, 2283578, 4205126, 7295526, 6246517, 1493570, 2939653, 5769134, 6845391,
8348858, 6241339, 5831293, 1416315, 4894611, 7795494, 8356971, 1904796, 2739086, 1298122,
1629867, 1421572, 2250284, 4222267, 3962274, 389160, 7092123, 3024641, 3496326, 6075004,
517124, 6618785, 8114979, 7703944, 1138889, 1240465, 28163, 1844240, 4686552, 2160386,
5512594, 7760014, 6244796, 7519805, 7161983, 8035435, 7116149, 5255994, 1053086, 5380821,
2490361, 3078953, 149966, 2662323, 6070477, 6586811, 7917965, 4318848, 2309794, 4944749,
6427458, 7066165, 1665386, 3238601, 5942938, 7455976, 1240339, 2153217, 7351999, 7424505,
5128736, 1964008, 4933934, 7542235, 5484370, 4126028, 4335755, 2123869, 8383463, 6596552,
5299166, 1587176, 4331708, 2144326, 7675927, 7611731, 1924818, 4287429, 6887651, 2501720,
534250, 1586814, 823900, 1723218, 731520, 5445059, 915930, 7412321, 1194060, 4420009,
5185427, 5793152, 935050, 1434946, 1292678, 6436655, 3310160, 6291589, 3533008, 7920168,
1306171, 2403825, 913285, 6464803, 578918, 8124486, 4454472, 4880977, 4491304, 605859,
1284361, 1368247, 1242552, 7739441, 6060253, 5769475, 3519455, 1997286, 8209646, 210912,
144531, 6115752, 7236238, 2474096, 4399603, 4172254, 2943434, 5812702, 6934208, 8172729,
5905199, 4419443, 1556603, 1645864, 5392445, 2845077, 2354190, 432934, 1610786, 2080041,
3459615, 6330916, 5622139, 7777805, 3132481, 5691738, 7623872, 2107815, 6104719, 747509,
8091014, 2992206, 1708614, 5120584, 1405816, 4056285, 4620372, 6172929, 3119643, 4697378,
5401179, 6573747, 3296606, 168330, 2051998, 1324483, 4918636, 5849556, 7885623, 6972914,
6775153, 2513543, 1620324, 3602798, 7611850, 4602204, 2454758, 4477162, 2042514, 506974,
4039870, 3843692, 4795871, 6223248, 4320007, 7775546, 310528, 7734180, 6067756, 5679474,
1336594, 2846921, 319669, 5340563, 8081606, 3320228, 4969396, 4516760, 6432898, 2805090,
1849375, 38833, 3936574, 3608060, 8263553, 3265463, 3601393, 613565, 751432, 7449517,
866476, 838550, 7268449, 4201000, 8140982, 7056512, 3513122, 7116264, 594751, 7541803,
6216020, 5034645, 6572193, 4971789, 3862199, 8261442, 7159345, 3078089, 1613266, 4307595,
7489368, 4734398, 6615721, 7318498, 7117080, 4183258, 1567826, 4814237, 2605671, 1768730,
7312956, 3179559, 6648041, 5648722, 547264, 3880333, 8090729, 4541000, 5499699, 2503695,
882585, 576849, 6797315, 8242450, 7912676, 1770164, 3717991, 46826, 7854881, 970128,
32227, 5694358, 4897114, 8162537, 5128047, 7533062, 4653092, 8298417, 3901556, 8025534,
5029744, 290396, 5638428, 7740179, 5510127, 3673401, 3227109, 8375539, 5853786, 4130252,
913983, 332254, 5112658, 3410573, 7191670, 1744337, 8155393, 723057, 3629549, 3962377,
4894760
};

int32_t zetas_inv[511] = {
	3502553, 4434936, 4767764, 7674256, 241920, 6652976, 1205643, 4986740, 3284655, 8065059,
7483330, 4267061, 2543527, 21774, 5170204, 4723912, 2887186, 657134, 2758885, 8106917,
3367569, 371779, 4495757, 98896, 3744221, 864251, 3269266, 234776, 3500199, 2702955,
8365086, 7427185, 542432, 8350487, 4679322, 6627149, 484637, 154863, 1599998, 7820464,
7514728, 5893618, 2897614, 3856313, 306584, 4516980, 7850049, 2748591, 1749272, 5217754,
1084357, 6628583, 5791642, 3583076, 6829487, 4214055, 1280233, 1078815, 1781592, 3662915,
907945, 4089718, 6784047, 5319224, 1237968, 135871, 4535114, 3425524, 1825120, 3362668,
2181293, 855510, 7802562, 1281049, 4884191, 1340801, 256331, 4196313, 1128864, 7558763,
7530837, 947796, 7645881, 7783748, 4795920, 5131850, 133760, 4789253, 4460739, 8358480,
6547938, 5592223, 1964415, 3880553, 3427917, 5077085, 315707, 3056750, 8077644, 5550392,
7060719, 2717839, 2329557, 663133, 8086785, 621767, 4077306, 2174065, 3601442, 4553621,
4357443, 7890339, 6354799, 3920151, 5942555, 3795109, 785463, 4794515, 6776989, 5883770,
1622160, 1424399, 511690, 2547757, 3478677, 7072830, 6345315, 8228983, 5100707, 1823566,
2996134, 3699935, 5277670, 2224384, 3776941, 4341028, 6991497, 3276729, 6688699, 5405107,
306299, 7649804, 2292594, 6289498, 773441, 2705575, 5264832, 619508, 2775174, 2066397,
4937698, 6317272, 6786527, 7964379, 6043123, 5552236, 3004868, 6751449, 6840710, 3977870,
2492114, 224584, 1463105, 2584611, 5453879, 4225059, 3997710, 5923217, 1161075, 2281561,
8252782, 8186401, 187667, 6400027, 4877858, 2627838, 2337060, 657872, 7154761, 7029066,
7112952, 7791454, 3906009, 3516336, 3942841, 272827, 7818395, 1932510, 7484028, 5993488,
7091142, 477145, 4864305, 2105724, 5087153, 1960658, 7104635, 6962367, 7462263, 2604161,
3211886, 3977304, 7203253, 984992, 7481383, 2952254, 7665793, 6674095, 7573413, 6810499,
7863063, 5895593, 1509662, 4109884, 6472495, 785582, 721386, 6252987, 4065605, 6810137,
3098147, 1800761, 13850, 6273444, 4061558, 4271285, 2912943, 855078, 3463379, 6433305,
3268577, 972808, 1045314, 6244096, 7156974, 941337, 2454375, 5158712, 6731927, 1331148,
1969855, 3452564, 6087519, 4078465, 479348, 1810502, 2326836, 5734990, 8247347, 5318360,
5906952, 3016492, 7344227, 3141319, 1281164, 361878, 1235330, 877508, 2152517, 637299,
2884719, 6236927, 3710761, 6553073, 8369150, 7156848, 7258424, 693369, 282334, 1778528,
7880189, 2322309, 4900987, 5372672, 1305190, 8008153, 4435039, 4175046, 6147029, 6975741,
6767446, 7099191, 5658227, 6492517, 40342, 601819, 3502702, 6980998, 2566020, 2155974,
48455, 1551922, 2628179, 5457660, 6903743, 2150796, 1101787, 4192187, 6113735, 4004123,
3470016, 6283156, 4077551, 217542, 8396943, 384143, 5160046, 8279999, 6247651, 6724996,
2200844, 2594459, 5917479, 8132781, 218409, 3805444, 6656560, 5206042, 2392104, 112281,
3644046, 355869, 1142946, 3650736, 7490012, 8041894, 6657779, 7775976, 6477762, 5235162,
4279941, 24146, 6136911, 958214, 4433481, 6745808, 7020372, 5412050, 939175, 7297814,
6021638, 2326115, 7108066, 4103778, 5213148, 3123571, 4321151, 7849754, 1651501, 7070305,
7826767, 94519, 350446, 2372067, 2206559, 5625706, 183470, 1974319, 6126223, 1206335,
1434100, 2172940, 2113237, 5333000, 7966987, 3850703, 3814127, 2863359, 5741952, 1611203,
5783147, 2530275, 2211336, 5591019, 8013972, 347137, 1495917, 4195627, 2299579, 3463112,
1539252, 5162443, 964479, 3812808, 292355, 4560533, 6614197, 1686782, 4337888, 390901,
2881149, 8354707, 3998327, 2264139, 3881474, 3910708, 7485952, 5675407, 412454, 4446103,
588976, 1650812, 8021952, 4998508, 3638989, 227350, 4625892, 1275694, 8264560, 3175345,
6107178, 1801670, 2451663, 4297715, 2022414, 3557848, 6096433, 6035281, 8002005, 3988432,
872757, 6851940, 805956, 6962574, 242585, 4941262, 5775725, 7921041, 4319212, 1261299,
7741906, 6472992, 7983542, 7202273, 4884336, 6523687, 7741279, 8326817, 5829524, 5150246,
1273853, 8156595, 1564439, 3228722, 4011730, 899397, 1385444, 7161729, 4310207, 511038,
8047437, 8156911, 2252797, 7504868, 631673, 3325406, 4613763, 2543292, 1932276, 3681488,
1674606, 444144, 4473753, 3108169, 6112203, 6230155, 4813934, 3995548, 1032212, 2326031,
53722, 6001502, 3807649, 7364823, 3048457, 8226201, 7022290, 651892, 5192584, 5772573,
5798762, 4134323, 5123861, 4882876, 2279896, 4766225, 6214669, 8013931, 5414774, 2724779,
6937759, 7822523, 1448431, 2068879, 2244326, 7425749, 8244880, 2500840, 6858828, 1462648,
1463119, 1753040, 2707401, 4729475, 3917976, 8272354, 6060228, 7424965, 6129175, 5169458,
3584677
};
#elif NIMS_TRI_NTT_MODE == 5
//Q = 8404993
//zeta = 4184677 //(2^8*3^3)th root of unity
//invMONT = 7896129
//invzeta = 1554873
//W = 6999551
#define MONT 15873 // 2^32 % Q

#define Wmont	6675549 //mont * W (W : 3rd root of unity)
#define W2mont	1713571 //mont * W^2
#define	F1	6642923 //mont^2/N
#define F2	4880853 //2 * mont^2/N

#define radix3_len 3 //radix-3 2번
#define radix2_redlen_ntt (N>>8)
#define radix2_redlen_invntt (N>>3)
int32_t zetas[2303] = {
	6691422, 3745396, 1005959, 5560684, 557530, 1359546, 5166674, 5884035, 4422884, 4240425,
5387571, 1046739, 2694230, 3252563, 6563702, 6365869, 2241533, 6130832, 3005748, 2818295,
1059740, 1575156, 6639601, 1563110, 7206912, 1200488, 285221, 8040721, 2282474, 6468071,
4739225, 2021449, 3517630, 7346728, 4905548, 5238671, 3440514, 4703105, 940539, 2892723,
6587485, 4244468, 3541424, 3284715, 964913, 106719, 2439163, 2652420, 2954142, 8379323,
7950516, 8059860, 1193423, 7129183, 7731829, 264713, 8060094, 445982, 8011185, 1369059,
7955478, 5679661, 6136964, 5113226, 3683432, 7938303, 6949595, 5152479, 1033092, 1728878,
8278066, 3908887, 4478964, 1661123, 751008, 3037667, 1719154, 4320384, 7339862, 4426392,
7097598, 7116055, 3331941, 1686410, 6321919, 1086929, 6201985, 1269346, 4028114, 1093944,
3364626, 7532885, 7083882, 6208581, 6588778, 2989190, 4018245, 905487, 7903618, 6818581,
2510402, 3495458, 8269219, 5100927, 4821549, 7197271, 7365006, 7566618, 5426137, 1390757,
4282185, 3438679, 4615431, 4943292, 483603, 8193371, 1190228, 2472636, 7326792, 4641031,
6575361, 6820008, 586507, 8339833, 1302054, 7839232, 2038881, 7951916, 2149249, 4851479,
6738222, 7925831, 1335443, 8252838, 2533493, 351317, 69907, 2530659, 67928, 4628830,
6097080, 6520199, 7059579, 3741732, 5872664, 1844725, 3046182, 6710463, 1533306, 777419,
8184245, 87056, 7368142, 4291236, 613216, 4955376, 1690952, 4474239, 6784644, 2909821,
7943851, 948115, 3618608, 3420707, 4466850, 8249857, 4873863, 2031465, 2812877, 7672067,
1196093, 1679678, 6892943, 280851, 4838437, 286108, 2180160, 5946783, 3280475, 2953005,
5294676, 1176, 5818203, 7589923, 6465761, 5542137, 6290777, 4603252, 7727308, 625905,
6148742, 4934225, 8349238, 6933212, 7729342, 3845758, 1099113, 6380048, 1313510, 1844170,
4995993, 8090989, 460717, 2321474, 6689731, 6053013, 577288, 3209389, 3044372, 2313948,
1145465, 7998760, 2770361, 5631248, 2577595, 7779883, 3552194, 226028, 4944063, 4270717,
4051664, 4953682, 4416567, 1351657, 806825, 574573, 304984, 6607630, 5841098, 6844990,
5184478, 5421164, 4815963, 7879235, 7430274, 6207605, 3475370, 459765, 7611163, 7678294,
5352327, 7606168, 278548, 675466, 7583149, 70338, 6948390, 4509876, 7342567, 3044034,
3566248, 4994119, 2649626, 7118134, 2661184,
	5187630, 5567006, 3283020, 3077132, 7100721, 239145, 7205603, 2837987, 6533880, 5628597,
1525979, 3521817, 7068951, 745421, 2338364, 2776396, 433795, 5317839, 8103639, 7215594,
1761601, 4128440, 7301990, 3087154, 1918808, 3078610, 4189694, 6955843, 4221177, 1629460,
7060028, 5326383, 6623753, 5696947, 561790, 2226114, 1845714, 7923061, 7669702, 2708046,
1693494, 5397589, 3206900, 3797749, 2675293, 790345, 7149337, 3007404, 2084479, 3675838,
6894862, 2267012, 1037511, 5942850, 4928233, 4729155, 3877418, 1560352, 4245121, 4513011,
4840800, 6073363, 4816015, 6844641, 3496258, 7711960, 1502833, 5071781, 1065441, 4378748,
2278413, 693033, 3998155, 3138798, 3918781, 4062299, 5597631, 7201097, 577673, 5266195,
6348454, 7651632, 1615887, 3007373, 7290967, 2254012, 7314433, 753361, 2928390, 4116231,
1957313, 7537819, 1910632, 3249057, 5449879, 4288762, 5471251, 4682175, 5899177, 4178133,
7561898, 455315, 1176741, 3722818, 6347835, 5794072, 5869587, 4163177, 7736376, 1552256,
6717711, 2610921, 3017256, 2194791, 4233387, 6193357, 4377683, 8388148, 5777692, 6210202,
432750, 7666377, 5915709, 6477821, 1019926, 5739205, 523805, 738616, 7006888, 7147319,
1205793, 1024022, 4810963, 8171341, 6449055, 1257674, 4099298, 8043782, 7046327, 7938055,
6603656, 7576844, 4933087, 361211, 4164473, 2064455, 5042866, 7464427, 5085005, 1123889,
6985765, 6340538, 5398894, 8059407, 7383307, 1748521, 3983219, 1402935, 8318036, 345586,
4994580, 6214078, 2089037, 1153908, 7662488, 7367986, 8253804, 2190915, 1600644, 3489556,
2482432, 3686699, 2246699, 7176255, 1690967, 4915437, 5879116, 7244355, 4633305, 1970528,
1979224, 809890, 305524, 1160638, 6986220, 7904390, 1204573, 3327482, 7394476, 2826879,
5140808, 500603, 2443041, 6362966, 7324321, 6816133, 6911327, 4774106, 3170047, 2042027,
8043159, 338314, 642322, 6559208, 8171543, 6897522, 2894702, 8066679, 3150419, 8072119,
5472635, 4784935, 5548711, 4452061, 1908653, 332874, 7898754, 3952911, 6388949, 3966429,
3887702, 7919340, 7277837, 4452082, 7987800, 2124377, 7835433, 193770, 1174089, 2318147,
5837469, 6280616, 6712164, 8120925, 3534051, 3930556, 6201675, 3646488, 7097227, 284068,
6346292, 5669951, 5976856, 3399944, 6198884, 664902, 4551327, 2735042, 4637472, 1278047,
561663, 1717263, 8129046, 2995310, 4040621, 7126946, 3955830, 6139634, 7073645, 2525292,
7850887, 259933, 7069324, 2265359, 4581463, 5065177, 5147187, 6452941, 227895, 3113125,
4496549, 3339816, 167912, 6830473, 4984262, 4765821, 4600007, 3191301, 6532576, 1574520,
5328189, 5677633, 6856973, 7210505, 7770178, 4483145, 5021465, 2727360, 6938462, 2034494,
8386746, 6897259, 8003572, 526760, 5186522, 6370499, 2916807, 8028648, 708975, 4860000,
767639, 4483655, 1982674, 376345, 4471806, 5028201, 7639276, 6004614, 5565476, 2627822,
7290660, 3376792, 2905059, 3212995, 4423591, 5230376, 4373588, 38378, 3638382, 5191998,
834406, 4282023, 6650272, 8118694, 8282850, 3995724, 1203031, 4122970, 7078619, 6234113,
5408457, 8254981, 1752194, 6084101, 7231488, 2170880, 6269352, 4882749, 1967458, 4114652,
7330106, 592408, 2033326, 3522244, 2254675, 2167372, 4154213, 5114650, 7700925, 7282022,
6208098, 6237621, 3410547, 2670958, 2896708, 3445189, 3049450, 6116147, 1543152, 5734035,
7172708, 1899663, 4625077, 5075383, 3502520, 6975046, 658962, 6505330, 133956, 4890573,
4588604, 1667288, 7484634, 6557861, 7065598, 3514420, 2181784, 7277985, 8099460, 6636700,
7724559, 5509692, 6547840, 1127008, 5162778, 4174789, 151844, 951646, 6272327, 5126435,
6466997, 4230204, 62725, 1789817, 3684852, 4345891, 7359327, 6135708, 437663, 6615176,
7613492, 5656764, 7133391, 3954033, 3588951, 1205804, 4351720, 2748229, 4046305, 6516893,
533274, 7460226, 6593856, 5572126, 2471360, 1888100, 421707, 4616032, 2178601, 5105759,
1144927, 1316798, 157050, 3788961, 3940319, 432545, 4317154, 7828807, 6574256, 8261352,
5952899, 7972448, 264222, 6096395, 968824, 4332540, 3502978, 2023942, 4151445, 2308598,
8019193, 2246053, 4634377, 8025549, 894087, 1866609, 1951098, 6158940, 7327274, 5635671,
6680549, 4531828, 6150636, 1762506, 2785171, 2769322, 7568212, 1720879, 2894875, 8352176,
6841511, 1668062, 5550621, 6684114, 8020815, 7345500, 2762178, 2186047, 718176, 1126554,
1613754, 1059493, 2943865, 4930522, 4879722, 1018070, 7585393, 5948592, 3557943, 3474471,
2366377, 1687941, 2042885, 6099328, 5141860, 7787269, 6906161, 6717052, 1150270, 4484909,
4949529, 3000607, 6413093, 7485516, 4884425, 3920084, 7998805, 2324488, 6144348, 3665474,
1022118, 5989962, 4429564, 6080505, 2654400, 5492721, 3982608, 7918049, 3861250, 5005777,
314137, 2912272, 7123335, 2138750, 1307768, 1405381, 56522, 5496949, 2803881, 3273713,
3841362, 5379076, 4698559, 276591, 2124750, 8128402, 1573250, 365669, 926563, 6266243,
2965391, 7517826, 7603213, 1681972, 8265246, 5131280, 1076883, 2510840, 7454905, 719370,
6838166, 2017962, 6883480, 4528273, 8379093, 4724763, 8200884, 3796430, 6258932, 4608563,
3043161, 6546235, 197274, 5894153, 1661017, 7235603, 5164872, 4515800, 6713958, 3876720,
3053345, 3284897, 1708002, 2889477, 5987846, 7928632, 3776738, 2437214, 7405893, 4370531,
3581890, 6109011, 2887591, 2295982, 2836279, 1960853, 4883958, 5120096, 5661133, 7655428,
3682426, 593495, 4831078, 5967779, 5928489, 3218336, 4579567, 6368024, 4815956, 90881,
5969652, 5609893, 5417020, 4423403, 5480542, 309582, 1978525, 8095411, 1207855, 5700774,
37923, 5186657, 2516353, 7641739, 7729595, 6677606, 4307141, 2795100, 220591, 640958,
2490308, 964338, 6124052, 1289973, 1289222, 7143007, 7341160, 1046318, 1004253, 803840,
4968594, 7601153, 6826739, 27987, 965528, 7764035, 7483526, 1687276, 4184278, 1768178,
6392363, 1261986, 1195165, 4141818, 3173353, 4012934, 4080321, 2597113, 3427919, 2351765,
3958285, 3053419, 6236896, 6036004, 6565165, 2368989, 3435061, 4948878, 1630666, 4263175,
233076, 7195237, 7227670, 1643945, 1982341, 6053228, 1385379, 3849778, 6300791, 5455581,
7245500, 2815114, 1906899, 2685377, 7016262, 7311930, 1356060, 2622406, 4575684, 5782587,
4616282, 5500491, 1731939, 4555215, 3409280, 2756715, 7967488, 8077987, 2966254, 5719616,
3542387, 6821894, 8143183, 833038, 6448849, 1482126, 1059673, 6017397, 6030946, 887784,
4724656, 3717125, 308157, 4687868, 6698800, 7499523, 2685500, 1583099, 1954392, 7709678,
4402060, 4550163, 688220, 2387596, 4775139, 6917896, 82329, 2884498, 2051694, 826626,
2350266, 2319634, 654376, 997529, 2986542, 2445560, 1535266, 5959433, 4324123, 3146260,
3929613, 1487097, 6303576, 7915425, 4020654, 5330058, 6080344, 6085359, 5801151, 335479,
6137798, 8199468, 2134627, 7769572, 7833721, 590575, 3947129, 7020596, 316758, 7477612,
1458408, 927381, 198719, 8360147, 3887307, 8069514, 4594806, 7356075, 2434996, 7272087,
1682318, 7814418, 286150, 5212041, 7950325, 6516880, 7445307, 3827543, 8240463, 5431617,
3567907, 7437147, 2645777, 515993, 5147067, 7889000, 6205316, 854167, 1487418, 3192952,
6679782, 4244195, 1118784, 7032873, 122290, 2973376, 8403952, 5342346, 3734452, 6813007,
4020, 7770593, 1721544, 6697026, 595299, 7709814, 4760469, 1231240, 7456006, 7173753,
2234481, 6062626, 7564399, 3062647, 8108525, 4647167, 7329055, 8044247, 1968406, 1707967,
6792039, 2905847, 4975695, 6315216, 7754677, 7294932, 2734127, 1153766, 1020684, 3489312,
874428, 2802528, 923239, 5602465, 8247009, 43705, 2030009, 5499146, 1845114, 6395159,
4875941, 712751, 2490863, 7251227, 6904101, 436055, 1151372, 5049782, 8218140, 2008432,
2952259, 8234385, 5655169, 53285, 2672259, 375556, 1275616, 8029437, 4695563, 1837824,
7596703, 7968938, 5734707, 489340, 7195223, 5425338, 3190534, 170608, 2560193, 2134780,
182827, 2002037, 8304009, 1255109, 7961863, 552180, 2508166, 4068464, 4884289, 1026249,
1308532, 7378744, 3556943, 1807289, 4030085, 6270213, 1584807, 6203244, 6780739, 3028286,
6184712, 7852813, 4882442, 1459264, 3706138, 3762892, 7595908, 704511, 6272386, 6848979,
3408152, 8237228, 775088, 4402245, 3798532, 4002748, 4617399, 7553490, 7542783, 6945729,
3718955, 1291499, 3601184, 8165137, 4822348, 1556014, 2868962, 5762218, 8101442, 1558317,
256852, 2120844, 4544227, 8014656, 4089620, 8119927, 2386297, 6889861, 1061026, 1515132,
7862474, 1730507, 1061927, 2642775, 2199724, 5477152, 4415594, 43185, 2695898, 390337,
1220102, 579728, 98416, 2460326, 5316226, 1011326, 3559563, 7468522, 5296878, 5941644,
3088345, 2246080, 861518, 6158913, 5739839, 74855, 4569434, 7825265, 4218374, 6521372,
2167149, 4706406, 6357485, 936471, 1114166, 3601159, 64479, 7214988, 4296225, 2003667,
6920201, 1682448, 6048652, 6122539, 1204287, 7070112, 2339278, 1334881, 7429373, 3686115,
2423427, 4803834, 5561365, 1318705, 5065261, 5880107, 2600386, 6722545, 2960884, 137000,
4676572, 8287716, 1016086, 913101, 8009340, 1631329, 6289421, 4430637, 8067790, 4108704,
7130109, 4296289, 3190779, 2544430, 7418037, 8267993, 200210, 4567637, 6241097, 3991427,
7171632, 6773664, 2585818, 2780826, 7873001, 5368915, 3627118, 1841808, 76719, 7948167,
3477546, 6874929, 406171, 1500222, 6550595, 6904771, 5789815, 1384982, 2825359, 5624167,
6500772, 1250762, 1535099, 6869137, 159577, 456826, 4767061, 1325706, 2521994, 4302871,
1792226, 5692079, 2556701, 459446, 7066224, 7551195, 6258634, 7269476, 1292506, 1135517,
7953767, 6151525, 2687103, 7079287, 2339794, 471908, 4996965, 3167354, 6393823, 7945547,
6769323, 5942610, 1229586, 4010547, 6146867, 1952340, 1400157, 4667160, 4855026, 5835515,
6413332, 7233851, 4945626, 1171142, 5050410, 6619500, 3282636, 2462383, 3417454, 3373132,
775053, 2839405, 5332655, 3737833, 5473969, 3830427, 5398103, 1267257, 8194029, 5109907,
5271973, 1320158, 1777361, 5462724, 1223069, 3829071, 5945015, 4575922, 4145792, 6430065,
5575682, 4574566, 3297810, 888158, 2094713, 5096328, 2888055, 7084835, 3398406, 5362736,
3845450, 6225608, 5430434, 5315668, 6128178, 4076601, 4220099, 3368571, 290431, 1234152,
4284267, 7170841, 7551265, 987276, 6078806, 3042257, 2837528, 326314, 2058495, 7459760,
1153340, 4328392, 6887926, 1116437, 3644378, 5546993, 190494, 5514068, 4026319, 7928226,
3157279, 7073044, 2448537, 7081300, 8233115, 1323693, 5237729, 5037301, 4224353, 7288556,
6198651, 8189481, 4889378, 4223300, 720722, 476767, 4142954, 457268, 2143940, 5452302,
7932492, 454032, 5746488, 8119552, 7562931, 7327303, 407967, 5130560, 4955017, 3274433,
7823426, 168591, 5305231, 7947725, 7506900, 7784571, 6522625, 2177869, 6156769, 285441,
769120, 4666753, 8215964, 5570646, 2818941, 2734099, 4931505, 3322933, 4962817, 2427710,
4088045, 5908989, 374951, 2496004, 7575010, 6057032, 4583311, 3738240, 7953248, 7094463,
4742723, 3074642, 5183998, 5082060, 3410505, 5145337, 2127721, 815886, 4899274, 3268115,
6223732, 7454054, 3090279, 6748393, 914530, 4338385, 1967591, 4066608, 6360043, 2317176,
2235894, 3259656, 2577273, 3488737, 2089292, 5154271, 2836572, 950939, 2219476, 6469601,
5714851, 2363031, 1238975, 2888804, 3077175, 3308921, 2483174, 6938646, 1051446, 3894353,
5300985, 4510640, 6206544, 6197725, 4429432, 1935392, 413620, 5003254, 6160780, 6257384,
5669300, 5096072, 4974429, 5812317, 40015, 7129659, 7943119, 1218973, 5706061, 4908903,
6709211, 5507530, 7491541, 1185413, 7407794, 7219580, 7000082, 6127876, 3221086, 2592676,
2650310, 2914854, 5396981, 8315072, 1755205, 3496090, 4019854, 5872648, 6463460, 8228884,
5283241, 8285746, 6996581, 937493, 569126, 3355612, 3888624, 751314, 7111435, 7653679,
2804122, 818246, 490026, 2532345, 6400065, 823267, 2653192, 575205, 5949954, 7467500,
4419272, 609825, 2363371, 1375226, 7616321, 2682550, 913830, 5284484, 3213265, 278546,
7492045, 3405395, 7315705, 4999598, 6260406, 7967034, 3261819, 7795168, 4111973, 888371,
2566023, 4780621, 1173116, 3120509, 3553115, 2259373, 2333198, 7213042, 255063, 7097777,
3301396, 7242635, 7017340, 5457520, 2268660, 2032526, 1125823, 6372467, 1668269, 5935419,
8247820, 6145620, 2490560, 7716893, 4154272, 840575, 3195651, 1162358, 343384, 3658352,
1637781, 1955976, 3348787, 6035139, 7183623, 7030454, 340723, 1626292, 3626545, 1834125,
982111, 6570868, 5940881, 4660600, 6041494, 4746641, 1736951, 5284644, 2504481, 3790101,
4337644, 1374539, 6950031, 7609615, 3950454, 310194, 6078801, 376555, 4215311, 5451510,
4096279, 1983069, 6635754, 7311162, 2961805, 1093831, 2680586, 5828065, 479648, 795378,
3385844, 1187691, 6247182, 7621356, 6568929, 2953483, 2112047, 8297137, 3075932, 7271297,
6062213, 5710165, 6193997, 2566540, 310111, 1303597, 8368587, 1045629, 1081993, 7359364,
2066004, 8276705, 2894488, 107856, 1581710, 1195741, 4439605, 8316926, 988967, 5838453,
6865201, 6897144, 7172898, 5507933, 6527496, 311869, 793704, 1499272, 2830604, 1404203,
6551063, 2231544, 2510101, 6173449, 4167752, 1811141, 6826138, 1507849, 4668027, 8301347,
3637370, 7739477, 2537991, 6905721, 637742, 2067583, 6665935, 977770, 1824523, 8214005,
7154775, 7895733, 8104291, 7053190, 5070150, 521174, 1452296, 7883819, 5815323, 7704745,
4225794, 6337410, 5837260, 715780, 2587542, 1498944, 5870687, 509260, 978845, 1071332,
7589002, 5042961, 5279006, 4384295, 5684755, 7885928, 3548609, 672255, 7937146, 5203418,
6386271, 3201575, 1610526, 3865230, 1061958, 7333661, 3743461, 1743587, 5229322, 1841386,
7367899, 519065, 8096703, 2930807, 1811911, 7793251, 3588481, 1466137, 2673938, 967537,
6016740, 6097774, 2366396, 4356008, 611502, 4048985, 5784151, 2433674, 5874020, 5474186,
167415, 623588, 5766847, 3744266, 1049030, 7437456, 2723088, 5629000, 1390285, 6408478,
505285, 2792843, 2497407, 2302798, 6800798, 263222, 4016976, 4336559, 6072751, 4068434,
2144811, 5095641, 8061699, 2775993, 412224, 5892222, 7333617, 2340044, 3397834, 6102195,
6552967, 8359348, 1123779, 5505080, 5504828, 5724366, 4467406, 7780799, 4611268, 4493514,
2368070, 2775909, 7810093, 5629084, 3327370, 5100172, 8110560, 45645, 2920976, 4447869,
1767232, 8280989, 6620121, 624194, 3274096, 4338428, 7483684, 3617019, 7218460, 7541292,
6133565, 1911891, 1318, 1651667, 5840661, 5853855, 1801241, 2551138, 8278041, 1048190,
8013322, 4066565, 5737960, 5990095, 3914354, 1065881, 2354428, 6493102, 7540957, 2263243,
5804160, 3371040, 5831477, 4203909, 1568611, 5809561, 6636229, 4427451, 2686639, 899497,
4318191, 7505496, 6938518, 1608477, 3622502, 6141750, 1211043, 6690694, 5403300, 4270537,
5326987, 2595432, 1147738, 1430521, 5671898, 7773611, 2519493, 1178652, 2944985, 2585148,
8214102, 2055283, 4298993, 5239876, 6057592, 3165117, 6168458, 3763800, 3421193, 6974472,
1961831, 3485804, 5756481, 4608494, 1894809, 5819845, 983744, 4776312, 914324, 5995331,
6422738, 3564737, 8168042, 4521556, 1982417, 3079392, 2537893, 7946121, 7582299, 458872,
3908318, 8086293, 706342, 3628681, 584941, 7855704, 6611016, 5536459, 4717052, 3883437,
7919056, 2531920, 5315714, 7395871, 7011568, 3412460, 2160136, 4519158, 8077002, 5607728,
6918050, 3923104, 2745579, 4481889, 2092273, 7931618, 7418556, 5873073, 6795210, 8139648,
8205940, 2913982, 4593587, 3885835, 5081858, 5335292, 2678934, 3812512, 3119881, 2329536,
2589239, 3267107, 477281, 3805942, 174400, 2597126, 3221793, 5807867, 2735629, 5596643,
4756030, 3069701, 1482220, 736241, 7118156, 6409638, 6435538, 5137886, 7527237, 4195569,
5650605, 6736213, 991639, 727916, 375157, 4052982, 8232807, 3217561, 174133, 2229075,
2420073, 6175918, 1726649, 4780898, 2983411, 4209424, 3859759, 7413130, 3915096, 560295,
3091737, 4352011, 5601588, 1016095, 5512376, 3851399, 4697693, 2421586, 2918981, 4458901,
3353002, 4556661, 8274913, 6843551, 2555131, 1561442, 3195343, 6880487, 693664, 7388898,
976425, 5572756, 6226430, 2289957, 5748567, 3946092, 8396540, 353452, 5771123, 2631695,
177974, 5315041, 7947821, 5389359, 3937664, 4015495, 5059624, 6535390, 5543522, 1869603,
8188964, 2299407, 7344113, 8051541, 6829268, 4368947, 7613071, 762092, 2451650, 3015634,
7313662, 3207212, 1817568, 718839, 8065641, 82262, 1774201, 3708827, 7779373, 5273231,
2910037, 2041755, 7625955, 6363238, 6871858, 3791089, 2766170, 5197781, 4009955, 75450,
7127620, 2760594, 1567076, 4696166, 2289253, 1335315, 3019244, 5331527, 5305236, 1816635,
6129117, 5397411, 4484841, 1077775, 674355, 149482, 507868, 8255511, 697451, 7214046,
218750, 7069678, 2603546, 2413090, 7115744, 5481009, 6077734, 3007582, 1500272, 3059070,
5029038, 2671562, 237691, 6953507, 4467637, 6320697, 3972, 1775399, 2972725, 3462514,
5377306, 4942479, 1721847, 4869211, 5030915, 5345923, 903145, 4834469, 6018885, 6134076,
2810040, 2084296, 5872427, 4763944, 6800749, 7714402, 6267765, 4217036, 1188585, 6073933,
440987, 4060524, 5704375, 2219561, 453984, 6185432, 7506945, 1885976, 3769452, 3641049,
3424947, 419475, 506665, 1528970, 895337, 2331060, 5045022, 3411882, 7375821, 8067023,
500835, 3581986, 1595299, 6973553, 4950070, 5939523, 64503, 5863331, 3673436, 2541662,
1992100, 2150546, 8364969, 4993111, 3207541, 946412, 3004946, 5525361, 8202130, 1431440,
2252566, 5330183, 1214956, 5939545, 965861, 7922106, 4816104, 376611, 1266753, 6345098,
997291, 1753836, 5406836, 6651157, 3969814, 8298717, 169391, 3074810, 6204090, 3270288,
7201589, 7693381, 4260335, 8028382, 3038166, 4397426, 3219729, 5666045, 4060268, 7573404,
2041022, 7025866, 317605, 7045489, 8225795, 4595967, 4092037, 3809026, 3372081, 6194277,
692999, 4007567, 7716711, 3037922, 8291926, 1857019, 3675238, 1379127, 3686733, 3629313,
7853498, 5774063, 8386286, 180372, 7619603, 7615172, 7560401, 8015515, 2039821, 2545577,
7734185, 5859416, 848264, 7795544, 5279069, 4775680, 1772678, 3239835, 1406511, 8319640,
4417675, 789821, 3688063, 7957560, 6796318, 5264234, 4481427, 7090428, 3361268, 8393123,
4232317, 4769105, 5113633, 3576752, 7832421, 4828241, 367196, 7078558, 152225, 447433,
2716628, 4321672, 5324446, 435993, 2661757, 11870, 8222125, 1368093, 3356541, 312129,
7294528, 6860547, 3784661, 3736529, 2308834, 1266532, 8056564, 2593631, 8080628, 5811362,
54531, 2192083, 7211174, 7036900, 3364627, 2634625, 5859631, 2905760, 5027996, 4668464,
896483, 5094234, 1392640, 3677636, 2109110, 1784620, 870345, 2131325, 4916655, 8385734,
5770663, 5185189, 8353976, 3219804, 5478527, 3915945, 6325147, 3310759, 2353594, 5074975,
6793207, 457832, 381949, 6273668, 5626630, 3870484, 7220026, 2347886, 95719, 6435240,
5589833, 6133316, 5171, 4315644, 2272455, 7871167, 1282920, 533826, 5904510, 4163563,
1900577, 4534509, 1939669, 8186128, 4350612, 1814060, 2464829, 2271677
};

int32_t zetas_inv[2303] = {
2464829,2271677,4350612,1814060,1939669,8186128,1900577,4534509,5904510,4163563 ,
1282920,533826,2272455,7871167,5171,4315644,5589833,6133316,95719,6435240 ,
7220026,2347886,5626630,3870484,381949,6273668,6793207,457832,2353594,5074975 ,
6325147,3310759,5478527,3915945,8353976,3219804,5770663,5185189,4916655,8385734 ,
870345,2131325,2109110,1784620,1392640,3677636,896483,5094234,5027996,4668464 ,
5859631,2905760,3364627,2634625,7211174,7036900,54531,2192083,8080628,5811362 ,
8056564,2593631,2308834,1266532,3784661,3736529,7294528,6860547,3356541,312129 ,
8222125,1368093,2661757,11870,5324446,435993,2716628,4321672,152225,447433 ,
367196,7078558,7832421,4828241,5113633,3576752,4232317,4769105,3361268,8393123 ,
4481427,7090428,6796318,5264234,3688063,7957560,4417675,789821,1406511,8319640 ,
1772678,3239835,5279069,4775680,848264,7795544,7734185,5859416,2039821,2545577 ,
7560401,8015515,7619603,7615172,8386286,180372,7853498,5774063,3686733,3629313 ,
3675238,1379127,8291926,1857019,7716711,3037922,692999,4007567,3372081,6194277 ,
4092037,3809026,8225795,4595967,317605,7045489,2041022,7025866,4060268,7573404 ,
3219729,5666045,3038166,4397426,4260335,8028382,7201589,7693381,6204090,3270288 ,
169391,3074810,3969814,8298717,5406836,6651157,997291,1753836,1266753,6345098 ,
4816104,376611,965861,7922106,1214956,5939545,2252566,5330183,8202130,1431440 ,
3004946,5525361,3207541,946412,8364969,4993111,1992100,2150546,3673436,2541662 ,
64503,5863331,4950070,5939523,1595299,6973553,500835,3581986,7375821,8067023 ,
5045022,3411882,895337,2331060,506665,1528970,3424947,419475,3769452,3641049 ,
7506945,1885976,453984,6185432,5704375,2219561,440987,4060524,1188585,6073933 ,
6267765,4217036,6800749,7714402,5872427,4763944,2810040,2084296,6018885,6134076 ,
903145,4834469,5030915,5345923,1721847,4869211,5377306,4942479,2972725,3462514 ,
3972,1775399,4467637,6320697,237691,6953507,5029038,2671562,1500272,3059070 ,
6077734,3007582,7115744,5481009,2603546,2413090,218750,7069678,697451,7214046 ,
507868,8255511,674355,149482,4484841,1077775,6129117,5397411,5305236,1816635 ,
3019244,5331527,2289253,1335315,1567076,4696166,7127620,2760594,4009955,75450 ,
2766170,5197781,6871858,3791089,7625955,6363238,2910037,2041755,7779373,5273231 ,
1774201,3708827,8065641,82262,1817568,718839,7313662,3207212,2451650,3015634 ,
7613071,762092,6829268,4368947,7344113,8051541,8188964,2299407,5543522,1869603 ,
5059624,6535390,3937664,4015495,7947821,5389359,177974,5315041,5771123,2631695 ,
8396540,353452,5748567,3946092,6226430,2289957,976425,5572756,693664,7388898 ,
3195343,6880487,2555131,1561442,8274913,6843551,3353002,4556661,2918981,4458901 ,
4697693,2421586,5512376,3851399,5601588,1016095,3091737,4352011,3915096,560295 ,
3859759,7413130,2983411,4209424,1726649,4780898,2420073,6175918,174133,2229075 ,
8232807,3217561,375157,4052982,991639,727916,5650605,6736213,7527237,4195569 ,
6435538,5137886,7118156,6409638,1482220,736241,4756030,3069701,2735629,5596643 ,
3221793,5807867,174400,2597126,477281,3805942,2589239,3267107,3119881,2329536 ,
2678934,3812512,5081858,5335292,4593587,3885835,8205940,2913982,6795210,8139648 ,
7418556,5873073,2092273,7931618,2745579,4481889,6918050,3923104,8077002,5607728 ,
2160136,4519158,7011568,3412460,5315714,7395871,7919056,2531920,4717052,3883437 ,
6611016,5536459,584941,7855704,706342,3628681,3908318,8086293,7582299,458872 ,
2537893,7946121,1982417,3079392,8168042,4521556,6422738,3564737,914324,5995331 ,
983744,4776312,1894809,5819845,5756481,4608494,1961831,3485804,3421193,6974472 ,
6168458,3763800,6057592,3165117,4298993,5239876,8214102,2055283,2944985,2585148 ,
2519493,1178652,5671898,7773611,1147738,1430521,5326987,2595432,5403300,4270537 ,
1211043,6690694,3622502,6141750,6938518,1608477,4318191,7505496,2686639,899497 ,
6636229,4427451,1568611,5809561,5831477,4203909,5804160,3371040,7540957,2263243 ,
2354428,6493102,3914354,1065881,5737960,5990095,8013322,4066565,8278041,1048190 ,
1801241,2551138,5840661,5853855,1318,1651667,6133565,1911891,7218460,7541292 ,
7483684,3617019,3274096,4338428,6620121,624194,1767232,8280989,2920976,4447869 ,
8110560,45645,3327370,5100172,7810093,5629084,2368070,2775909,4611268,4493514 ,
4467406,7780799,5504828,5724366,1123779,5505080,6552967,8359348,3397834,6102195 ,
7333617,2340044,412224,5892222,8061699,2775993,2144811,5095641,6072751,4068434 ,
4016976,4336559,6800798,263222,2497407,2302798,505285,2792843,1390285,6408478 ,
2723088,5629000,1049030,7437456,5766847,3744266,167415,623588,5874020,5474186 ,
5784151,2433674,611502,4048985,2366396,4356008,6016740,6097774,2673938,967537 ,
3588481,1466137,1811911,7793251,8096703,2930807,7367899,519065,5229322,1841386 ,
3743461,1743587,1061958,7333661,1610526,3865230,6386271,3201575,7937146,5203418 ,
3548609,672255,5684755,7885928,5279006,4384295,7589002,5042961,978845,1071332 ,
5870687,509260,2587542,1498944,5837260,715780,4225794,6337410,5815323,7704745 ,
1452296,7883819,5070150,521174,8104291,7053190,7154775,7895733,1824523,8214005 ,
6665935,977770,637742,2067583,2537991,6905721,3637370,7739477,4668027,8301347 ,
6826138,1507849,4167752,1811141,2510101,6173449,6551063,2231544,2830604,1404203 ,
793704,1499272,6527496,311869,7172898,5507933,6865201,6897144,988967,5838453 ,
4439605,8316926,1581710,1195741,2894488,107856,2066004,8276705,1081993,7359364 ,
8368587,1045629,310111,1303597,6193997,2566540,6062213,5710165,3075932,7271297 ,
2112047,8297137,6568929,2953483,6247182,7621356,3385844,1187691,479648,795378 ,
2680586,5828065,2961805,1093831,6635754,7311162,4096279,1983069,4215311,5451510 ,
6078801,376555,3950454,310194,6950031,7609615,4337644,1374539,2504481,3790101 ,
1736951,5284644,6041494,4746641,5940881,4660600,982111,6570868,3626545,1834125 ,
340723,1626292,7183623,7030454,3348787,6035139,1637781,1955976,343384,3658352 ,
3195651,1162358,4154272,840575,2490560,7716893,8247820,6145620,1668269,5935419 ,
1125823,6372467,2268660,2032526,7017340,5457520,3301396,7242635,255063,7097777 ,
2333198,7213042,3553115,2259373,1173116,3120509,2566023,4780621,4111973,888371 ,
3261819,7795168,6260406,7967034,7315705,4999598,7492045,3405395,3213265,278546 ,
913830,5284484,7616321,2682550,2363371,1375226,4419272,609825,5949954,7467500 ,
2653192,575205,6400065,823267,490026,2532345,2804122,818246,7111435,7653679 ,
3888624,751314,569126,3355612,6996581,937493,5283241,8285746,6463460,8228884 ,
4019854,5872648,1755205,3496090,5396981,8315072,2650310,2914854,3221086,2592676 ,
7000082,6127876,7407794,7219580,7491541,1185413,6709211,5507530,5706061,4908903 ,
7943119,1218973,40015,7129659,4974429,5812317,5669300,5096072,6160780,6257384 ,
413620,5003254,4429432,1935392,6206544,6197725,5300985,4510640,1051446,3894353 ,
2483174,6938646,3077175,3308921,1238975,2888804,5714851,2363031,2219476,6469601 ,
2836572,950939,2089292,5154271,2577273,3488737,2235894,3259656,6360043,2317176 ,
1967591,4066608,914530,4338385,3090279,6748393,6223732,7454054,4899274,3268115 ,
2127721,815886,3410505,5145337,5183998,5082060,4742723,3074642,7953248,7094463 ,
4583311,3738240,7575010,6057032,374951,2496004,4088045,5908989,4962817,2427710 ,
4931505,3322933,2818941,2734099,8215964,5570646,769120,4666753,6156769,285441 ,
6522625,2177869,7506900,7784571,5305231,7947725,7823426,168591,4955017,3274433 ,
407967,5130560,7562931,7327303,5746488,8119552,7932492,454032,2143940,5452302 ,
4142954,457268,720722,476767,4889378,4223300,6198651,8189481,4224353,7288556 ,
5237729,5037301,8233115,1323693,2448537,7081300,3157279,7073044,4026319,7928226 ,
190494,5514068,3644378,5546993,6887926,1116437,1153340,4328392,2058495,7459760 ,
2837528,326314,6078806,3042257,7551265,987276,4284267,7170841,290431,1234152 ,
4220099,3368571,6128178,4076601,5430434,5315668,3845450,6225608,3398406,5362736 ,
2888055,7084835,2094713,5096328,3297810,888158,5575682,4574566,4145792,6430065 ,
5945015,4575922,1223069,3829071,1777361,5462724,5271973,1320158,8194029,5109907 ,
5398103,1267257,5473969,3830427,5332655,3737833,775053,2839405,3417454,3373132 ,
3282636,2462383,5050410,6619500,4945626,1171142,6413332,7233851,4855026,5835515 ,
1400157,4667160,6146867,1952340,1229586,4010547,6769323,5942610,6393823,7945547 ,
4996965,3167354,2339794,471908,2687103,7079287,7953767,6151525,1292506,1135517 ,
6258634,7269476,7066224,7551195,2556701,459446,1792226,5692079,2521994,4302871 ,
4767061,1325706,159577,456826,1535099,6869137,6500772,1250762,2825359,5624167 ,
5789815,1384982,6550595,6904771,406171,1500222,3477546,6874929,76719,7948167 ,
3627118,1841808,7873001,5368915,2585818,2780826,7171632,6773664,6241097,3991427 ,
200210,4567637,7418037,8267993,3190779,2544430,7130109,4296289,8067790,4108704 ,
6289421,4430637,8009340,1631329,1016086,913101,4676572,8287716,2960884,137000 ,
2600386,6722545,5065261,5880107,5561365,1318705,2423427,4803834,7429373,3686115 ,
2339278,1334881,1204287,7070112,6048652,6122539,6920201,1682448,4296225,2003667 ,
64479,7214988,1114166,3601159,6357485,936471,2167149,4706406,4218374,6521372 ,
4569434,7825265,5739839,74855,861518,6158913,3088345,2246080,5296878,5941644 ,
3559563,7468522,5316226,1011326,98416,2460326,1220102,579728,2695898,390337 ,
4415594,43185,2199724,5477152,1061927,2642775,7862474,1730507,1061026,1515132 ,
2386297,6889861,4089620,8119927,4544227,8014656,256852,2120844,8101442,1558317 ,
2868962,5762218,4822348,1556014,3601184,8165137,3718955,1291499,7542783,6945729 ,
4617399,7553490,3798532,4002748,775088,4402245,3408152,8237228,6272386,6848979 ,
7595908,704511,3706138,3762892,4882442,1459264,6184712,7852813,6780739,3028286 ,
1584807,6203244,4030085,6270213,3556943,1807289,1308532,7378744,4884289,1026249 ,
2508166,4068464,7961863,552180,8304009,1255109,182827,2002037,2560193,2134780 ,
3190534,170608,7195223,5425338,5734707,489340,7596703,7968938,4695563,1837824 ,
1275616,8029437,2672259,375556,5655169,53285,2952259,8234385,8218140,2008432 ,
1151372,5049782,6904101,436055,2490863,7251227,4875941,712751,1845114,6395159 ,
2030009,5499146,8247009,43705,923239,5602465,874428,2802528,1020684,3489312 ,
2734127,1153766,7754677,7294932,4975695,6315216,6792039,2905847,1968406,1707967 ,
7329055,8044247,8108525,4647167,7564399,3062647,2234481,6062626,7456006,7173753 ,
4760469,1231240,595299,7709814,1721544,6697026,4020,7770593,3734452,6813007 ,
8403952,5342346,122290,2973376,1118784,7032873,6679782,4244195,1487418,3192952 ,
6205316,854167,5147067,7889000,2645777,515993,3567907,7437147,8240463,5431617 ,
7445307,3827543,7950325,6516880,286150,5212041,1682318,7814418,2434996,7272087 ,
4594806,7356075,3887307,8069514,198719,8360147,1458408,927381,316758,7477612 ,
3947129,7020596,7833721,590575,2134627,7769572,6137798,8199468,5801151,335479 ,
6080344,6085359,4020654,5330058,6303576,7915425,3929613,1487097,4324123,3146260 ,
1535266,5959433,2986542,2445560,654376,997529,2350266,2319634,2051694,826626 ,
82329,2884498,4775139,6917896,688220,2387596,4402060,4550163,1954392,7709678 ,
2685500,1583099,6698800,7499523,308157,4687868,4724656,3717125,6030946,887784 ,
1059673,6017397,6448849,1482126,8143183,833038,3542387,6821894,2966254,5719616 ,
7967488,8077987,3409280,2756715,1731939,4555215,4616282,5500491,4575684,5782587 ,
1356060,2622406,7016262,7311930,1906899,2685377,7245500,2815114,6300791,5455581 ,
1385379,3849778,1982341,6053228,7227670,1643945,233076,7195237,1630666,4263175 ,
3435061,4948878,6565165,2368989,6236896,6036004,3958285,3053419,3427919,2351765 ,
4080321,2597113,3173353,4012934,1195165,4141818,6392363,1261986,4184278,1768178 ,
7483526,1687276,965528,7764035,6826739,27987,4968594,7601153,1004253,803840 ,
7341160,1046318,1289222,7143007,6124052,1289973,2490308,964338,220591,640958 ,
4307141,2795100,7729595,6677606,2516353,7641739,37923,5186657,1207855,5700774 ,
1978525,8095411,5480542,309582,5417020,4423403,5969652,5609893,4815956,90881 ,
4579567,6368024,5928489,3218336,4831078,5967779,3682426,593495,5661133,7655428 ,
4883958,5120096,2836279,1960853,2887591,2295982,3581890,6109011,7405893,4370531 ,
3776738,2437214,5987846,7928632,1708002,2889477,3053345,3284897,6713958,3876720 ,
5164872,4515800,1661017,7235603,197274,5894153,3043161,6546235,6258932,4608563 ,
8200884,3796430,8379093,4724763,6883480,4528273,6838166,2017962,7454905,719370 ,
1076883,2510840,8265246,5131280,7603213,1681972,2965391,7517826,926563,6266243 ,
1573250,365669,2124750,8128402,4698559,276591,3841362,5379076,2803881,3273713 ,
56522,5496949,1307768,1405381,7123335,2138750,314137,2912272,3861250,5005777 ,
3982608,7918049,2654400,5492721,4429564,6080505,1022118,5989962,6144348,3665474 ,
7998805,2324488,4884425,3920084,6413093,7485516,4949529,3000607,1150270,4484909 ,
6906161,6717052,5141860,7787269,2042885,6099328,2366377,1687941,3557943,3474471 ,
7585393,5948592,4879722,1018070,2943865,4930522,1613754,1059493,718176,1126554 ,
2762178,2186047,8020815,7345500,5550621,6684114,6841511,1668062,2894875,8352176 ,
7568212,1720879,2785171,2769322,6150636,1762506,6680549,4531828,7327274,5635671 ,
1951098,6158940,894087,1866609,4634377,8025549,8019193,2246053,4151445,2308598 ,
3502978,2023942,968824,4332540,264222,6096395,5952899,7972448,6574256,8261352 ,
4317154,7828807,3940319,432545,157050,3788961,1144927,1316798,2178601,5105759 ,
421707,4616032,2471360,1888100,6593856,5572126,533274,7460226,4046305,6516893 ,
4351720,2748229,3588951,1205804,7133391,3954033,7613492,5656764,437663,6615176 ,
7359327,6135708,3684852,4345891,62725,1789817,6466997,4230204,6272327,5126435 ,
151844,951646,5162778,4174789,6547840,1127008,7724559,5509692,8099460,6636700 ,
2181784,7277985,7065598,3514420,7484634,6557861,4588604,1667288,133956,4890573 ,
658962,6505330,3502520,6975046,4625077,5075383,7172708,1899663,1543152,5734035 ,
3049450,6116147,2896708,3445189,3410547,2670958,6208098,6237621,7700925,7282022 ,
4154213,5114650,2254675,2167372,2033326,3522244,7330106,592408,1967458,4114652 ,
6269352,4882749,7231488,2170880,1752194,6084101,5408457,8254981,7078619,6234113 ,
1203031,4122970,8282850,3995724,6650272,8118694,834406,4282023,3638382,5191998 ,
4373588,38378,4423591,5230376,2905059,3212995,7290660,3376792,5565476,2627822 ,
7639276,6004614,4471806,5028201,1982674,376345,767639,4483655,708975,4860000 ,
2916807,8028648,5186522,6370499,8003572,526760,8386746,6897259,6938462,2034494 ,
5021465,2727360,7770178,4483145,6856973,7210505,5328189,5677633,6532576,1574520 ,
4600007,3191301,4984262,4765821,167912,6830473,4496549,3339816,227895,3113125 ,
5147187,6452941,4581463,5065177,7069324,2265359,7850887,259933,7073645,2525292 ,
3955830,6139634,4040621,7126946,8129046,2995310,561663,1717263,4637472,1278047 ,
4551327,2735042,6198884,664902,5976856,3399944,6346292,5669951,7097227,284068 ,
6201675,3646488,3534051,3930556,6712164,8120925,5837469,6280616,1174089,2318147 ,
7835433,193770,7987800,2124377,7277837,4452082,3887702,7919340,6388949,3966429 ,
7898754,3952911,1908653,332874,5548711,4452061,5472635,4784935,3150419,8072119 ,
2894702,8066679,8171543,6897522,642322,6559208,8043159,338314,3170047,2042027 ,
6911327,4774106,7324321,6816133,2443041,6362966,5140808,500603,7394476,2826879 ,
1204573,3327482,6986220,7904390,305524,1160638,1979224,809890,4633305,1970528 ,
5879116,7244355,1690967,4915437,2246699,7176255,2482432,3686699,1600644,3489556 ,
8253804,2190915,7662488,7367986,2089037,1153908,4994580,6214078,8318036,345586 ,
3983219,1402935,7383307,1748521,5398894,8059407,6985765,6340538,5085005,1123889 ,
5042866,7464427,4164473,2064455,4933087,361211,6603656,7576844,7046327,7938055 ,
4099298,8043782,6449055,1257674,4810963,8171341,1205793,1024022,7006888,7147319 ,
523805,738616,1019926,5739205,5915709,6477821,432750,7666377,5777692,6210202 ,
4377683,8388148,4233387,6193357,3017256,2194791,6717711,2610921,7736376,1552256 ,
5869587,4163177,6347835,5794072,1176741,3722818,7561898,455315,5899177,4178133 ,
5471251,4682175,5449879,4288762,1910632,3249057,1957313,7537819,2928390,4116231 ,
7314433,753361,7290967,2254012,1615887,3007373,6348454,7651632,577673,5266195 ,
5597631,7201097,3918781,4062299,3998155,3138798,2278413,693033,1065441,4378748 ,
1502833,5071781,3496258,7711960,4816015,6844641,4840800,6073363,4245121,4513011 ,
3877418,1560352,4928233,4729155,1037511,5942850,6894862,2267012,2084479,3675838 ,
7149337,3007404,2675293,790345,3206900,3797749,1693494,5397589,7669702,2708046 ,
1845714,7923061,561790,2226114,6623753,5696947,7060028,5326383,4221177,1629460 ,
4189694,6955843,1918808,3078610,7301990,3087154,1761601,4128440,8103639,7215594 ,
433795,5317839,2338364,2776396,7068951,745421,1525979,3521817,6533880,5628597 ,
7205603,2837987,7100721,239145,3283020,3077132,5187630,5567006 ,

5743809, 1286859, 5755367, 3410874, 4838745, 5360959, 1062426, 3895117, 1456603, 8334655,
821844, 7729527, 8126445, 798825, 3052666, 726699, 793830, 7945228, 4929623, 2197388,
974719, 525758, 3589030, 2983829, 3220515, 1560003, 2563895, 1797363, 8100009, 7830420,
7598168, 7053336, 3988426, 3451311, 4353329, 4134276, 3460930, 8178965, 4852799, 625110,
5827398, 2773745, 5634632, 406233, 7259528, 6091045, 5360621, 5195604, 7827705, 2351980,
1715262, 6083519, 7944276, 314004, 3409000, 6560823, 7091483, 2024945, 7305880, 4559235,
675651, 1471781, 55755, 3470768, 2256251, 7779088, 677685, 3801741, 2114216, 2862856,
1939232, 815070, 2586790, 8403817, 3110317, 5451988, 5124518, 2458210, 6224833, 8118885,
3566556, 8124142, 1512050, 6725315, 7208900, 732926, 5592116, 6373528, 3531130, 155136,
3938143, 4984286, 4786385, 7456878, 461142, 5495172, 1620349, 3930754, 6714041, 3449617,
7791777, 4113757, 1036851, 8317937, 220748, 7627574, 6871687, 1694530, 5358811, 6560268,
2532329, 4663261, 1345414, 1884794, 2307913, 3776163, 8337065, 5874334, 8335086, 8053676,
5871500, 152155, 7069550, 479162, 1666771, 3553514, 6255744, 453077, 6366112, 565761,
7102939, 65160, 7818486, 1584985, 1829632, 3763962, 1078201, 5932357, 7214765, 211622,
7921390, 3461701, 3789562, 4966314, 4122808, 7014236, 2978856, 838375, 1039987, 1207722,
3583444, 3304066, 135774, 4909535, 5894591, 1586412, 501375, 7499506, 4386748, 5415803,
1816215, 2196412, 1321111, 872108, 5040367, 7311049, 4376879, 7135647, 2203008, 7318064,
2083074, 6718583, 5073052, 1288938, 1307395, 3978601, 1065131, 4084609, 6685839, 5367326,
7653985, 6743870, 3926029, 4496106, 126927, 6676115, 7371901, 3252514, 1455398, 466690,
4721561, 3291767, 2268029, 2725332, 449515, 7035934, 393808, 7959011, 344899, 8140280,
673164, 1275810, 7211570, 345133, 454477, 25670, 5450851, 5752573, 5965830, 8298274,
7440080, 5120278, 4863569, 4160525, 1817508, 5512270, 7464454, 3701888, 4964479, 3166322,
3499445, 1058265, 4887363, 6383544, 3665768, 1936922, 6122519, 364272, 8119772, 7204505,
1198081, 6841883, 1765392, 6829837, 7345253, 5586698, 5399245, 2274161, 6163460, 2039124,
1841291, 5152430, 5710763, 7358254, 3017422, 4164568, 3982109, 2520958, 3238319, 7045447,
7847463, 2844309, 7399034, 4659597, 3949336
};
#endif


void ntt(int32_t * Out, int32_t * A){
	int32_t zeta1;
	int32_t t1;
	int len, start, j, k=0;

	if(Out!=A){
		memcpy(Out,A,sizeof(int32_t)*N);
	}

	zeta1 = zetas[k++];
	for(j = 0; j < N/2; j++)
	{
		t1 = montgomery_reduce((int64_t)zeta1 * Out[j + N/2]);

		Out[j + N/2] = Out[j] + Out[j + N/2] - t1;
		Out[j      ] = Out[j] + t1;
	}

	for (len = N>>2; len >=  3 * radix3_len; len >>= 1)
	{ // radix-2
		for (start = 0; start < N; start += (len << 1))
		{
			zeta1 = zetas[k++];

			for (j = start; j < start + len; j++)
			{
				t1 = montgomery_reduce((int64_t)zeta1 * Out[j + len]);
				Out[j + len] = Out[j] - t1;
				Out[j] = Out[j] + t1;
			}
		}
	}

#if NIMS_TRI_NTT_MODE != 3
	int32_t zeta2;
	int32_t t2,t3;

	for (len = radix3_len; len >= 1; len = len / 3)
	{ // radix-3
		for (start = 0; start < N; start += 3 * len)
		{
			zeta1 = zetas[k++];
			zeta2 = zetas[k++];

			for(j = start; j < start + len; j++)
			{
				t1 = montgomery_reduce((int64_t)zeta1 * Out[j + len]);
				t2 = montgomery_reduce((int64_t)zeta2 * Out[j + 2*len]);
				t3 = montgomery_reduce((int64_t)Wmont * (t1-t2)); //w
				Out[j + 2*len] = Out[j] - (t1 + t3);
				Out[j + len] = Out[j] - t2 + t3;
				Out[j    ] = Out[j] + t1 + t2;
			}
		}
	}
#endif
}
void invntt_tomont(int32_t * Out, int32_t * A){
	int32_t zeta1;
	int32_t t1,t2,t3;
	int len, start, j, k=0;

	if(Out!=A) memcpy(Out,A,sizeof(int32_t)*N);

#if NIMS_TRI_NTT_MODE != 3
	int32_t zeta2;

	for(len = 1; len <= radix3_len ; len = 3*len)
	{//radix-3
		for(start = 0; start < N; start += 3*len)
		{
			zeta1 = zetas_inv[k++];
			zeta2 = zetas_inv[k++];
			for(j = start; j < start + len; j++)
			{
				t1 = Out[j+len] - Out[j];
				t1 = montgomery_reduce((int64_t)Wmont * t1);
				t2 =  t1 + Out[j+ 2*len] - Out[j];;
				t3 = Out[j+ 2*len] - Out[j +len] - t1;
				Out[j    ] = Out[j] + Out[j+ 2*len] + Out[j +len];
				Out[j + len] = montgomery_reduce((int64_t)zeta1 * t2);
				Out[j + 2*len] =  montgomery_reduce((int64_t)zeta2 * t3);
			}
		}
	}
#endif
	for (len = 3 * radix3_len; len <= N>>2; len <<= 1)
	{//radix-2
		for (start = 0; start < N; start = j + len)
		{
			zeta1 = zetas_inv[k++];
			for (j = start; j < start + len; ++j)
			{
				t1 = Out[j];
				Out[j] = t1 + Out[j + len];
				Out[j + len] = t1 - Out[j + len];
				Out[j + len] = montgomery_reduce((int64_t)zeta1 * Out[j + len]);
			}
		}
	}

	zeta1 = zetas_inv[k];
	for(int i = 0; i < N>>1; i++)
	{
		t1 = Out[i] + Out[i + N/2];
		t2 = montgomery_reduce((int64_t)zeta1 * (Out[i] - Out[i + N/2]));

		Out[i] = montgomery_reduce((int64_t)F1 * (t1 - t2));
		Out[i + N/2] = montgomery_reduce((int64_t)F2 * t2);
	}
}

void pointwise_mul(int32_t* C, int32_t* A, int32_t* B){
	for(int i=0;i<N;i++){
		C[i] = montgomery_reduce((int64_t)A[i] * B[i]);
	}
}
void base_mul(int32_t* C, int32_t* A, int32_t* B, int32_t zeta){ //2차식 곱셈
	C[0]=montgomery_reduce((int64_t)A[2]*B[1] + (int64_t)A[1]*B[2]);
	C[0]=montgomery_reduce((int64_t)C[0]*zeta + (int64_t)A[0]*B[0]);

	C[1]  = montgomery_reduce((int64_t)A[2]* B[2]);
	C[1]  = montgomery_reduce((int64_t)C[1]* zeta + (int64_t)A[0]* B[1] + (int64_t)A[1]* B[0]) ;

	C[2]  = montgomery_reduce((int64_t)A[2]* B[0] + (int64_t)A[1]* B[1] + (int64_t)A[0]* B[2]);
}
void poly_base_mul(poly* c, poly* a, poly* b){
	#if NIMS_TRI_NTT_MODE==3 //2차식 곱셈(poly)
	for(int i=0;i<N/6;i++){
		int32_t zeta=zetas[i+255];
		base_mul(c->coeffs + i*6, a->coeffs + i*6, b->coeffs + i*6, zeta);
		base_mul(c->coeffs + i*6 + 3, a->coeffs + i*6 + 3, b->coeffs + i*6 + 3, -zeta);
	}
	#else//pointwise 곱셈
	for(int i=0;i<N;i++){
		c->coeffs[i] = montgomery_reduce((int64_t)(a->coeffs[i]) * (b->coeffs[i]));
	}
	#endif

}

void reduce_modQ(int32_t * a){
  for(int i=0;i<N;i++){ 
	a[i]=a[i] % Q;
  }
}


void poly_mul_schoolbook(poly* res, poly* a, poly* b)
{
	// Polynomial multiplication using the schoolbook method, c[x] = a[x]*b[x] 
	// SECURITY NOTE: TO BE USED FOR TESTING ONLY.  
	uint32_t i, j;

	int32_t c[N << 1];
	int32_t t0;
	for (i = 0; i < (N << 1); i++) c[i] = 0;

	for (i = 0; i < N; i++)
	{
		for (j = 0; j < N; j++)
		{
			t0 = ((int64_t)(Q+a->coeffs[i]) * (Q+b->coeffs[j])) % Q;
			c[i + j] = (c[i + j] + t0) % Q;
		}
	}

	for (i = N + (N >> 1) - 1; i < 2 * N - 1; i++) {
		c[i - (N>>1)] = (c[i - (N>>1)] + c[i]) % Q;
		c[i - N] = (Q + c[i - N] - c[i]) % Q;
	}


	for (i = N; i < N + (N >> 1) - 1; i++)
	{
		c[i - (N>>1)] = (c[i - (N>>1)] + c[i]) % Q;
		c[i - N] = (Q + c[i - N] - c[i]) % Q;
	}

	for (i = 0; i < N; i++)
		res->coeffs[i] = c[i];	
}

void poly_caddq(poly *a) {
	unsigned int i;

	for (i = 0; i < N; ++i)
		a->coeffs[i] = caddq(a->coeffs[i]);

}

void poly_add(poly *c, const poly *a, const poly *b) {
	unsigned int i;

	for (i = 0; i < N; ++i)
		c->coeffs[i] = a->coeffs[i] + b->coeffs[i];

}

void poly_modadd(poly *c, poly *a, poly *b) {
	unsigned int i;

	for (i = 0; i < N; ++i)
		c->coeffs[i] = mod_add(a->coeffs[i], b->coeffs[i]);

}

void poly_sub(poly *c, poly *a, poly *b) {
	unsigned int i;

	for (i = 0; i < N; ++i)
		c->coeffs[i] = a->coeffs[i] - b->coeffs[i];

}

void poly_modsub(poly *c, poly *a, poly *b) {
	unsigned int i;
	for (i = 0; i < N; ++i)
		c->coeffs[i] = mod_sub(a->coeffs[i], b->coeffs[i]);
}

void poly_shiftl(poly *a) {
	unsigned int i;

	for (i = 0; i < N; ++i)
		a->coeffs[i] <<= D;

}

void poly_power2round(poly *a1, poly *a0, const poly *a) {
	unsigned int i;

	for (i = 0; i < N; ++i)
		a1->coeffs[i] = power2round(&a0->coeffs[i], a->coeffs[i]);

}

void poly_decompose(poly *a1, poly *a0, const poly *a) {
	unsigned int i;

	for (i = 0; i < N; ++i)
		a1->coeffs[i] = decompose(&a0->coeffs[i], a->coeffs[i]);

}

unsigned int poly_make_hint(poly *h, const poly *a0, const poly *a1) {
	unsigned int i, s = 0;

	for (i = 0; i < N; ++i) {
		h->coeffs[i] = make_hint(a0->coeffs[i], a1->coeffs[i]);
		s += h->coeffs[i];
	}

	return s;
}

void poly_use_hint(poly *b, const poly *a, const poly *h) {
	unsigned int i;

	for (i = 0; i < N; ++i)
		b->coeffs[i] = use_hint(a->coeffs[i], h->coeffs[i]);

}

int poly_chknorm(poly *a, int32_t B) {
	unsigned int i;
	int32_t t;
	crypto_int32 anygeB = 0;

	if (B > (Q - 1) / 8)
		return 1;

	for (i = 0; i < N; ++i) {
		/* Absolute value */
		t = crypto_int32_negative_mask(a->coeffs[i]);
		t = a->coeffs[i] - (t & 2 * a->coeffs[i]);

		anygeB |= crypto_int32_leq_mask(B,t);
	}
	return -anygeB;
}

static unsigned int rej_uniform(int32_t *a,
	unsigned int len,
	const uint8_t *buf,
	unsigned int buflen)
{
	unsigned int ctr, pos;
	uint32_t t;
	crypto_uint32 tcond;

	ctr = pos = 0;
	while (ctr < len && pos + 3 <= buflen) {
		t = buf[pos++];
		t |= (uint32_t)buf[pos++] << 8;
		t |= (uint32_t)buf[pos++] << 16;
		t &= 0xFFFFFF;

		tcond = crypto_uint32_smaller_mask(t,Q) & crypto_uint32_nonzero_mask(t);
		crypto_declassify(&tcond,sizeof tcond);
		if (tcond)
			a[ctr++] = t;
	}

	return ctr;
}

#define POLY_UNIFORM_NBLOCKS ((768 + STREAM128_BLOCKBYTES - 1)/STREAM128_BLOCKBYTES)
void poly_uniform(poly *a,
	const uint8_t seed[SEEDBYTES],
	uint16_t nonce)
{
	unsigned int i, ctr, off;
	unsigned int buflen = POLY_UNIFORM_NBLOCKS * STREAM128_BLOCKBYTES;
	uint8_t buf[POLY_UNIFORM_NBLOCKS*STREAM128_BLOCKBYTES + 2];
	stream128_state state;

	stream128_init(&state, seed, nonce);
	stream128_squeezeblocks(buf, POLY_UNIFORM_NBLOCKS, &state);

	ctr = rej_uniform(a->coeffs, N, buf, buflen);

	while (ctr < N) {
		off = buflen % 3;
		for (i = 0; i < off; ++i)
			buf[i] = buf[buflen - off + i];

		stream128_squeezeblocks(buf + off, 1, &state);
		buflen = STREAM128_BLOCKBYTES + off;
		ctr += rej_uniform(a->coeffs + ctr, N - ctr, buf, buflen);
	}
}

static unsigned int rej_eta(int32_t *a,
	unsigned int len,
	const uint8_t *buf,
	unsigned int buflen)
{
	unsigned int ctr, pos;
	uint32_t t0, t1;
	uint32_t t2, t3;

	ctr = pos = 0;
	while (ctr < len && pos < buflen) {
		crypto_uint32 t0less3, t1less3, t2less3, t3less3;

		t0 = buf[pos] & 0x03;
		t1 = (buf[pos] >> 2) & 0x03;
		t2 = (buf[pos] >> 4) & 0x03;
		t3 = buf[pos++] >> 6;

		t0less3 = crypto_uint32_smaller_mask(t0,3);
		crypto_declassify(&t0less3,sizeof t0less3);
		if(t0less3) {
			a[ctr++] = 1 - t0;
		}
		t1less3 = crypto_uint32_smaller_mask(t1,3);
		crypto_declassify(&t1less3,sizeof t1less3);
		if (t1less3 && ctr < len) {
			a[ctr++] = 1 - t1;
		}
		t2less3 = crypto_uint32_smaller_mask(t2,3);
		crypto_declassify(&t2less3,sizeof t2less3);
		if (t2less3 && ctr < len) {
			a[ctr++] = 1 - t2;
		}
		t3less3 = crypto_uint32_smaller_mask(t3,3);
		crypto_declassify(&t3less3,sizeof t3less3);
		if (t3less3 && ctr < len) {
			a[ctr++] = 1 - t3;
		}
	}

	return ctr;
}

#define POLY_UNIFORM_ETA_NBLOCKS ((136 + STREAM256_BLOCKBYTES - 1)/STREAM256_BLOCKBYTES)
void poly_uniform_eta(poly *a,
	const uint8_t seed[CRHBYTES],
	uint16_t nonce)
{
	unsigned int ctr;
	unsigned int buflen = POLY_UNIFORM_ETA_NBLOCKS * STREAM256_BLOCKBYTES;
	uint8_t buf[POLY_UNIFORM_ETA_NBLOCKS*STREAM256_BLOCKBYTES];
	stream256_state state;

	stream256_init(&state, seed, nonce);
	stream256_squeezeblocks(buf, POLY_UNIFORM_ETA_NBLOCKS, &state);

	ctr = rej_eta(a->coeffs, N, buf, buflen);

	while (ctr < N) {
		stream256_squeezeblocks(buf, 1, &state);
		ctr += rej_eta(a->coeffs + ctr, N - ctr, buf, STREAM256_BLOCKBYTES);
	}
}

#define POLY_UNIFORM_GAMMA1_NBLOCKS ((POLYZ_PACKEDBYTES + STREAM256_BLOCKBYTES - 1)/STREAM256_BLOCKBYTES)

void poly_uniform_gamma1(poly *a,
	const uint8_t seed[CRHBYTES],
	uint16_t nonce)
{
	uint8_t buf[POLY_UNIFORM_GAMMA1_NBLOCKS*STREAM256_BLOCKBYTES];
	stream256_state state;

	stream256_init(&state, seed, nonce);
	stream256_squeezeblocks(buf, POLY_UNIFORM_GAMMA1_NBLOCKS, &state);
	polyz_unpack(a, buf);
}
//sample in ball
void poly_challenge(poly *c, const uint8_t seed[SEEDBYTES]) {
	unsigned int i, b, pos;
	uint32_t signs;
	uint8_t buf[SHAKE256_RATE];
	keccak_state state;

	shake256_init(&state);
	shake256_absorb(&state, seed, SEEDBYTES);
	shake256_finalize(&state);
	shake256_squeezeblocks(buf, 1, &state);

	signs = 0;
	for (i = 0; i < 4; ++i)
		signs |= (uint32_t)buf[i] << 8 * i;
	pos = 4;

	for (i = 0; i < N; ++i)
		c->coeffs[i] = 0;
#if (N==2304)
	for (i = N - TAU; i < N; ++i) {
		do {
			if (pos >= SHAKE256_RATE) {
				shake256_squeezeblocks(buf, 1, &state);
				pos = 0;
			}

			b = (uint32_t)buf[pos++] << 4;
			b |= (buf[pos++] & 0xF);
			crypto_declassify(&b,sizeof b);	// patch
		} while (b > i);

		c->coeffs[i] = c->coeffs[b];
		c->coeffs[b] = 1 - 2 * (crypto_int64_bottombit_01(signs));
		signs >>= 1;
	}
#else
	for (i = N - TAU; i < N; ++i) {
		do {
			if (pos >= SHAKE256_RATE) {
				shake256_squeezeblocks(buf, 1, &state);
				pos = 0;
			}

			b = (uint32_t)buf[pos++] << 3;
			b |= (buf[pos++] & 0x7);
			crypto_declassify(&b,sizeof b);	// patch
		} while (b > i);

		c->coeffs[i] = c->coeffs[b];
		c->coeffs[b] = 1 - 2 * (crypto_int64_bottombit_01(signs));
		signs >>= 1;
	}
#endif
}
/*************************************************
* Name:        poly_reduce
*
* Description: Inplace reduction of all coefficients of polynomial to
*              representative in [-6283009,6283007](딜리시움).
*
* Arguments:   - poly *a: pointer to input/output polynomial
**************************************************/
void poly_reduce(poly *a) {
  unsigned int i;

  for(i = 0; i < N; ++i)
    a->coeffs[i] = reduce32(a->coeffs[i]);

}
